import{a as t,c as s,d as e,f as a,u as i}from"./index.670b29b2.js";import{_ as n}from"./V-Avatar.vue_vue&type=script&setup=true&lang.b24e093a.js";import{u as l}from"./useDropdown.490deeca.js";import{s as o}from"./sleep.2a252ff4.js";import{r as c,v as r,b as d,B as u,C as p,d as v,W as _,j as m,k as b,n as g,E as k,U as w,u as y,A as h,$ as f,l as x,a as z,w as C,f as V,m as D,a6 as j}from"./vendor.6243191d.js";import{a as N,_ as U}from"./V-Field.vue_vue&type=script&setup=true&lang.50df6a27.js";import{_ as P}from"./MinimalLayout.7b609a14.js";const S=c(1),I=c(!1),T=r((()=>{switch(S.value){case 2:return"初始化管理节点";case 3:return"初始化计算节点";case 1:default:return"初始化网络"}}));const A=d({name:"",description:"",relatedTo:"UX/Design",logo:null,timeFrame:c({start:new Date,end:new Date}),budget:"< 5K",attachments:[],teammates:[],tools:[],customer:null}),E=f();u("data-v-53f4972c");const F={class:"wizard-navigation"},$={class:"title-wrap"},q=g("i",{class:"iconify","data-icon":"feather:chevron-down"},null,-1),K={id:"wizard-navigation-dropdown",class:"dropdown-menu",role:"menu"},L={class:"dropdown-content"},M={class:"navbar-item is-dark-mode"},O={class:"profile-avatar"},X=g("i",{class:"iconify","data-icon":"feather:chevron-down"},null,-1),B={class:"dropdown-menu",role:"menu"},R={class:"dropdown-content"},W={class:"dropdown-item"},G={class:"is-size-7 dark-inverted"},H=g("hr",{class:"dropdown-divider"},null,-1),J=g("i",{class:"iconify","data-icon":"feather:log-out"},null,-1),Q=g("span",null,"退出登录",-1);p();var Y=v({expose:[],setup(i){t();const o=s(),c=e(),{dropdownElement:d,toggle:u,close:p,isOpen:v}=l(),{dropdownElement:f,toggle:z,isOpen:C}=l(),V=t=>{S.value>=t&&(S.value=t,p())},D=r((()=>c.state.channel.user));return _((()=>{c.dispatch("channel/getProfile")})),(t,s)=>{const e=a,i=x("RouterLink"),l=n;return m(),b("nav",F,[g(i,{to:{name:"index"},class:"wizard-brand"},{default:E((()=>[g(e,{width:"38px",height:"38px"})])),_:1}),g("div",{class:"navbar-item is-wizard-title",onClick:s[1]||(s[1]=(...t)=>y(u)&&y(u)(...t))},[g("span",$,[k(w(y(S))+"/3 ",1),g("span",null,w(y(T)),1)])]),g("div",{ref:d,class:[[y(v)&&"is-active"],"dropdown wizard-dropdown dropdown-trigger"]},[g("div",{class:"is-trigger",onClick:s[2]||(s[2]=(...t)=>y(u)&&y(u)(...t))},[q]),g("div",K,[g("div",L,[g("a",{class:[[y(S)<1&&"is-disabled"],"dropdown-item kill-drop"],onClick:s[3]||(s[3]=t=>V(1))}," 1/3 初始化网络 ",2),g("a",{class:[[y(S)<3&&"is-disabled"],"dropdown-item kill-drop"],onClick:s[4]||(s[4]=t=>V(3))}," 2/3 初始化管理节点 ",2),g("a",{class:[[y(S)<4&&"is-disabled"],"dropdown-item kill-drop"],onClick:s[5]||(s[5]=t=>V(4))}," 3/3 初始化计算节点 ",2)])])],2),g("div",M,[h("",!0)]),g("div",{ref:f,class:[[y(C)&&"is-active"],"dropdown is-right dropdown-trigger user-dropdown"]},[g("div",{class:"is-trigger","aria-haspopup":"true",onClick:s[7]||(s[7]=(...t)=>y(z)&&y(z)(...t))},[g("div",O,[y(D).ex_logined?(m(),b(l,{key:0,initials:(y(D).real_name||y(D).real_name).substr(0,1)},null,8,["initials"])):h("",!0)]),X]),g("div",B,[g("div",R,[g("div",W,[g("p",G,w(y(D).user_name),1)]),H,g("a",{href:"#",class:"dropdown-item",onClick:s[8]||(s[8]=t=>{c.dispatch("channel/logout").then((()=>{o.push({name:"login"})}))})},[J,Q])])])],2)])}}});Y.__scopeId="data-v-53f4972c";const Z={key:0,class:"wizard-v1-wrapper"},tt={class:"step-content"},st={class:"step-title"},et=g("h2",{class:"dark-inverted"},"初始化网络",-1),at={key:0},it={key:1},nt={key:2,class:"is-danger"},lt={key:3},ot={class:"page-placeholder is-files"},ct={class:"placeholder-content"},rt={key:0,src:"/assets/init-net-success.4be9414d.svg",alt:""},dt={key:1,src:"/assets/init-net-err.32a88bdb.svg",alt:""},ut={key:2,src:"/assets/init-net.96e2f020.svg",alt:""},pt={class:"wizard-success-text"},vt={key:0,class:"loader is-loading"},_t={key:1},mt={class:"wizard-buttons is-active"},bt={class:"wizard-buttons-inner"},gt={key:3,class:"light-text"},kt={key:4,class:"light-text"},wt={class:"step-content"},yt={class:"step-title"},ht=g("h2",{class:"dark-inverted"},"管理节点",-1),ft={key:0},xt={key:1},zt={key:2,class:"is-danger"},Ct={key:3},Vt={class:"page-placeholder is-files"},Dt={class:"placeholder-content"},jt={key:0,src:"/assets/init-controller-success.ec4b8c81.svg",alt:""},Nt={key:1,src:"/assets/init-controller-err.1645a731.svg",alt:""},Ut={key:2,src:"/assets/init-controller.7e77420d.svg",alt:""},Pt={key:0,class:"wizard-success-text"},St=g("div",{class:"loader is-loading"},null,-1),It={key:1,class:"form-card wizard-error-box"},Tt={class:"wizard-buttons is-active"},At={class:"wizard-buttons-inner"},Et={key:3,class:"light-text"},Ft={class:"step-content"},$t={class:"step-title"},qt=g("h2",{class:"dark-inverted"},"计算节点",-1),Kt={key:0},Lt={key:1},Mt={key:2,class:"is-danger"},Ot={key:3},Xt={class:"form-card"},Bt=k(" "),Rt={key:0,class:"check-icon-box"},Wt=g("img",{class:"hero-image",src:"/assets/check-ok.657a5c02.svg",alt:""},null,-1),Gt=k(" "),Ht={key:1,class:"check-icon-box"},Jt=g("img",{class:"hero-image",src:"/assets/check-error.f774bc4f.svg",alt:""},null,-1),Qt={key:0,class:"wizard-success-text"},Yt=g("div",{class:"loader is-loading"},null,-1),Zt={key:1,class:"form-card wizard-error-box"},ts={class:"wizard-buttons is-active"},ss={class:"wizard-buttons-inner"},es={key:3,class:"light-text"};var as=v({expose:[],setup(a){const n=t(),l=s(),c=e(),u=async()=>{S.value<7?S.value++:7===S.value?(await async function(){I.value=!0,await o(2e3),I.value=!1}(),S.value++):(l.push({name:"navbar-layouts-projects-details"}),A.name="",A.description="",A.relatedTo="UX/Design",A.logo=null,A.timeFrame={start:new Date,end:new Date},A.budget="< 5K",A.attachments=[],A.teammates=[],A.tools=[],A.customer=null)};i({title:`${T.value}`}),z(S,(()=>{l.push({query:{step:S.value}})})),C((()=>{const t=n.query.step;t&&(S.value=parseInt(t))}));let p=0;const v=()=>{p&&window.clearInterval(p),p=window.setInterval((()=>{c.dispatch("user/getInitStatus"),console.log("initStatus",k)}),2e3)},k=r((()=>c.state.user.initStatus)),f=r((()=>c.state.channel.user)),E=r((()=>c.getters["channel/getSpecTypes"])),F=()=>{c.dispatch("user/initNet"),v()},$=()=>{l.push({name:"user-projects"})},q=()=>{c.dispatch("user/applyController"),v()},K=d({specs_type:void 0,specs_cpu_arch:void 0}),L=()=>{console.log("formData",K),c.dispatch("user/applyAgent",K),v()},M=r((()=>(console.log("store.state.channel.user",c.state.channel.user.ex_cpu),c.state.channel.user.ex_cpu?c.state.channel.user.ex_cpu.map((t=>({value:t}))):[])));return _((()=>{c.dispatch("user/getInitStatus").then((t=>{t.net||l.push({name:"login"}),setTimeout((()=>{console.log("specTypes",E)}),2e3)}))})),V((()=>{window.clearInterval(p)})),(t,s)=>{const e=Y,a=x("Multiselect"),i=N,n=U,l=P;return m(),b(l,null,{default:D((()=>[g(e,{step:y(S),"onUpdate:step":s[1]||(s[1]=t=>j(S)?S.value=t:null),title:y(T)},null,8,["step","title"]),g("progress",{id:"wizard-progress",class:"progress is-smaller is-primary wizard-progress",value:y(S)/4*100,max:"100"},null,8,["value"]),y(k).net?(m(),b("div",Z,[g("div",{id:"wizard-step-0",class:["inner-wrapper",[1===y(S)&&"is-active"]]},[g("div",tt,[g("div",st,[et,1===y(k).net.net_init_status?(m(),b("p",at,"SDN网络创建完毕，VPN服务已启动")):2===y(k).net.net_init_status?(m(),b("p",it,"正在为您创建SDN网络，启动VPN服务，大约需要3-5分钟")):3===y(k).net.net_init_status?(m(),b("p",nt,w(y(k).net.init_msg),1)):(m(),b("p",lt,"点击开始将为您创建SDN网络，启动VPN服务"))]),g("div",ot,[g("div",ct,[1===y(k).net.net_init_status?(m(),b("img",rt)):3===y(k).net.net_init_status?(m(),b("img",dt)):(m(),b("img",ut))])]),g("div",pt,[2===y(k).net.net_init_status?(m(),b("div",vt)):h("",!0),1===y(k).net.net_init_status?(m(),b("div",_t,[y(f).user_id?(m(),b("a",{key:0,class:"action-link toggle-uploader-link",href:`/api/user/download/ovpn/${y(f).user_id}`,target:"_blank",onClick:s[2]||(s[2]=s=>t.isUploading=!0)},"下载VPN证书",8,["href"])):h("",!0),g("a",{class:"action-link toggle-uploader-link",onClick:s[3]||(s[3]=s=>t.isUploading=!0)},"VPN连接指南")])):h("",!0)]),g("div",mt,[g("div",bt,[0===y(k).net.net_init_status?(m(),b("button",{key:0,class:"button v-button is-bold wizard-button-next is-primary",name:"button",onClick:F},"开始初始化网络")):h("",!0),3===y(k).net.net_init_status?(m(),b("button",{key:1,class:"button v-button is-bold wizard-button-next is-primary",name:"button",onClick:F},"重新初始化网络")):h("",!0),1===y(k).net.net_init_status&&1===y(k).downloaded_ovpn?(m(),b("button",{key:2,class:"button v-button is-bold wizard-button-next is-primary",name:"button",onClick:u},"下一步: 管理节点")):h("",!0),2===y(k).net.net_init_status?(m(),b("span",gt,"初始化中，请稍候")):h("",!0),1===y(k).net.net_init_status&&1!==y(k).downloaded_ovpn?(m(),b("span",kt,"请先下载VPN证书")):h("",!0)])])])],2),g("div",{id:"wizard-step-1",class:["inner-wrapper",[2===y(S)&&"is-active"]]},[g("div",wt,[g("div",yt,[ht,1===y(k).cc.c_init_status?(m(),b("p",ft,"管理节点创建成功, 点击下一步继续")):2===y(k).cc.c_init_status?(m(),b("p",xt,"正在为您创建管理节点，这可能要花费几分钟的时间")):3===y(k).cc.c_init_status?(m(),b("p",zt,"管理节点创建失败, 点击重试按钮重新创建")):(m(),b("p",Ct,"适配项目将在容器环境中进行，为您创建独立的管理节点。"))]),g("div",Vt,[g("div",Dt,[1===y(k).cc.c_init_status?(m(),b("img",jt)):3===y(k).cc.c_init_status?(m(),b("img",Nt)):(m(),b("img",Ut))])]),2===y(k).cc.c_init_status?(m(),b("div",Pt,[St])):h("",!0),3===y(k).cc.c_init_status?(m(),b("div",It,w(y(k).cc.init_msg),1)):h("",!0),g("div",Tt,[g("div",At,[0===y(k).cc.c_init_status?(m(),b("button",{key:0,class:"button v-button is-bold wizard-button-next is-primary",name:"button",onClick:q},"开始初始化管理节点")):h("",!0),1===y(k).cc.c_init_status?(m(),b("button",{key:1,class:"button v-button is-bold wizard-button-next is-primary",name:"button",onClick:u},"下一步: 计算节点")):h("",!0),3===y(k).cc.c_init_status?(m(),b("button",{key:2,class:"button v-button is-bold wizard-button-next is-primary",name:"button",onClick:q},"重新初始化管理节点")):h("",!0),2===y(k).cc.c_init_status?(m(),b("span",Et,"创建中，请稍候")):h("",!0)])])])],2),g("div",{id:"wizard-step-2",class:["inner-wrapper",[3===y(S)&&"is-active"]]},[g("div",Ft,[g("div",$t,[qt,1===y(k).ca.a_init_status?(m(),b("p",Kt,"计算节点初始化完毕，所有初始化任务完成，点击下方按钮开始项目适配")):2===y(k).ca.a_init_status?(m(),b("p",Lt,"计算节点将为您提供运算能力，请依据您的需要进行选择")):3===y(k).ca.a_init_status?(m(),b("p",Mt,w(y(k).net.init_msg),1)):(m(),b("p",Ot,"计算节点将为您提供运算能力，请依据您的需要进行选择"))]),g("div",Xt,[Bt,1===y(k).ca.a_init_status?(m(),b("div",Rt,[Wt])):h("",!0),Gt,3===y(k).ca.a_init_status?(m(),b("div",Ht,[Jt])):h("",!0),g(n,null,{default:D((()=>[g(i,null,{default:D((()=>[g(a,{modelValue:y(K).specs_type,"onUpdate:modelValue":s[4]||(s[4]=t=>y(K).specs_type=t),label:"name",placeholder:"选择规格",options:y(E)},null,8,["modelValue","options"])])),_:1})])),_:1}),g(n,null,{default:D((()=>[g(i,null,{default:D((()=>[g(a,{modelValue:y(K).specs_cpu_arch,"onUpdate:modelValue":s[5]||(s[5]=t=>y(K).specs_cpu_arch=t),label:"value",placeholder:"选择CPU类型",options:y(M)},null,8,["modelValue","options"])])),_:1})])),_:1})]),2===y(k).ca.a_init_status?(m(),b("div",Qt,[Yt])):h("",!0),3===y(k).ca.c_init_status?(m(),b("div",Zt,w(y(k).ca.init_msg),1)):h("",!0),g("div",ts,[g("div",ss,[0===y(k).ca.a_init_status?(m(),b("button",{key:0,class:"button v-button is-bold wizard-button-next is-primary",name:"button",onClick:L},"开始初始化计算节点")):h("",!0),1===y(k).ca.a_init_status?(m(),b("button",{key:1,class:"button v-button is-bold wizard-button-next is-primary",name:"button",onClick:$},"开始项目适配")):h("",!0),3===y(k).ca.a_init_status?(m(),b("button",{key:2,class:"button v-button is-bold wizard-button-next is-primary",name:"button",onClick:L},"重新初始化计算节点")):h("",!0),2===y(k).ca.a_init_status?(m(),b("span",es,"初始化中，请稍候")):h("",!0)])])])],2)])):h("",!0)])),_:1})}}});export default as;
