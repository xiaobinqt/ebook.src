var e=Object.defineProperty,l=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,s=Object.prototype.propertyIsEnumerable,t=(l,a,s)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[a]=s,i=(e,i)=>{for(var d in i||(i={}))l.call(i,d)&&t(e,d,i[d]);if(a)for(var d of a(i))s.call(i,d)&&t(e,d,i[d]);return e};import{_ as d}from"./V-Breadcrumb.vue_vue&type=script&setup=true&lang.95222eda.js";import{_ as o,a as r}from"./V-Field.vue_vue&type=script&setup=true&lang.50df6a27.js";import{_ as c}from"./V-Checkbox.vue_vue&type=script&setup=true&lang.27382a85.js";import{_ as n}from"./V-Button.vue_vue&type=script&setup=true&lang.7d7c3fd2.js";import{_ as u}from"./V-Loader.vue_vue&type=script&setup=true&lang.152a1df5.js";import{_ as p}from"./V-Buttons.vue_vue&type=script&setup=true&lang.88c78073.js";import{_ as v}from"./V-Message.vue_vue&type=script&setup=true&lang.177426e4.js";import{d as m,r as f,v as b,b as _,W as y,j as h,k as g,n as j,m as V,u as z,A as k,l as x,P as U,X as w,Z as O,F as q,S as A,U as P,E as C,O as S}from"./vendor.6243191d.js";import{a as B,c as E,d as M,u as $}from"./index.670b29b2.js";import{u as F}from"./useNotyf.8c9a8697.js";import{a as L,t as D}from"./activeSidebarState.4b53b430.js";const I={class:"form-card",style:{width:"auto",height:"auto"}},N={class:"form-inner"},T={class:"field is-horizontal"},W=j("div",{class:"field-label is-normal"},[j("label",{class:"label required"},"应用名称")],-1),X={class:"field-body"},Z={class:"field is-horizontal"},G=j("div",{class:"field-label is-normal"},[j("label",{class:"label"},"描述")],-1),H={class:"field-body"},J={class:"field is-horizontal"},K=j("div",{class:"field-label is-normal"},[j("label",{class:"label required"},"选择数据图表")],-1),Q={class:"field-body"},R={class:"select"},Y=j("option",{value:"0"},"不显示",-1),ee={key:0,class:"field is-horizontal"},le=j("div",{class:"field-label is-normal"},[j("label",{class:"label required"},"显示图表")],-1),ae={class:"field-body"},se={class:"field is-horizontal"},te=j("div",{class:"field-label is-normal"},[j("label",{class:"label required"},"选择制品包")],-1),ie={class:"field-body"},de={class:"select"},oe=j("option",{value:""},"请选择制品包",-1),re={class:"field is-horizontal"},ce=j("div",{class:"field-label is-normal"},[j("label",{class:"label required"},"选择终端设备")],-1),ne={class:"field-body"},ue={class:"select"},pe=j("option",{value:""},"使用仿真边",-1),ve={key:1,class:"field is-horizontal"},me=j("div",{class:"field-label is-normal"},[j("label",{class:"label required"},"终端模型")],-1),fe={class:"field-body"},be={class:"select"},_e=j("option",{value:""},"请选择终端模型",-1),ye={key:2,class:"field is-horizontal"},he=j("div",{class:"field-label is-normal"},[j("label",{class:"label"},"选择数据集")],-1),ge={class:"field-body"},je={class:"field is-horizontal"},Ve=j("div",{class:"field-label is-normal"},[j("label",{class:"label"})],-1),ze={class:"field-body"},ke=C("取消"),xe=C("确定"),Ue={class:"field is-horizontal"},we=j("div",{class:"field-label is-normal"},null,-1),Oe={class:"field-body"};var qe=m({expose:[],setup(e){const l=B(),a=E(),s=M(),t=F(),d=f(""),m=f(!1);b((()=>s.state.user.project));const S=b((()=>s.state.user.artifacts)),$=b((()=>s.state.channel.physicals)),L=b((()=>s.state.channel.types)),D=b((()=>s.getters["channel/getEdgeModels"])),qe=f(),Ae=_({name:"",desc:"",artifact_name:"",data_set:[],model:"",location:"",edge_id:"",display_type:"0",charts:[]}),Pe={1:"数据集1",2:"数据集2",3:"数据集3"},Ce=()=>{console.log("types",L.value.data);const e=L.value.data.find((e=>e.type_id===Ae.display_type));e&&(qe.value=e)};return y((()=>{s.dispatch("user/getArtfacts",{id:l.params.projectid}),console.log("types",L),s.dispatch("channel/getAppTypes",{page:1,size:100}),s.dispatch("channel/getPhysicals").then((()=>{console.log("physicals",$)})),s.dispatch("channel/getAgents",{page:0,size:200}).then((e=>{}))})),(e,f)=>{const b=r,_=o,y=c,B=x("Multiselect"),E=n,M=u,F=p,Se=v;return h(),g("div",I,[j("div",N,[j("div",T,[W,j("div",X,[j(_,null,{default:V((()=>[j(b,null,{default:V((()=>[U(j("input",{"onUpdate:modelValue":f[1]||(f[1]=e=>z(Ae).name=e),class:"input",type:"text",placeholder:"应用名称只能输入大小写字母、减号或下划线"},null,512),[[w,z(Ae).name]])])),_:1})])),_:1})])]),j("div",Z,[G,j("div",H,[j(_,null,{default:V((()=>[j(b,null,{default:V((()=>[U(j("textarea",{"onUpdate:modelValue":f[2]||(f[2]=e=>z(Ae).desc=e),class:"textarea",rows:"3",placeholder:"请输入描述"},"\n              ",512),[[w,z(Ae).desc]])])),_:1})])),_:1})])]),j("div",J,[K,j("div",Q,[j(_,null,{default:V((()=>[j(b,null,{default:V((()=>[j("div",R,[U(j("select",{onChange:Ce,"onUpdate:modelValue":f[3]||(f[3]=e=>z(Ae).display_type=e)},[Y,(h(!0),g(q,null,A(z(L).data,(e=>(h(),g("option",{value:e.type_id},P(e.name),9,["value"])))),256))],544),[[O,z(Ae).display_type]])])])),_:1})])),_:1})])]),"0"!==z(Ae).display_type?(h(),g("div",ee,[le,j("div",ae,[j(_,null,{default:V((()=>[qe.value&&qe.value.charts?(h(),g(b,{key:0},{default:V((()=>[(h(!0),g(q,null,A(qe.value.charts,(e=>(h(),g(y,{modelValue:z(Ae).charts,"onUpdate:modelValue":f[4]||(f[4]=e=>z(Ae).charts=e),value:e.name,label:e.name,color:"primary"},null,8,["modelValue","value","label"])))),256))])),_:1})):k("",!0)])),_:1})])])):k("",!0),j("div",se,[te,j("div",ie,[j(_,null,{default:V((()=>[j(b,null,{default:V((()=>[j("div",de,[U(j("select",{"onUpdate:modelValue":f[5]||(f[5]=e=>z(Ae).artifact_name=e)},[oe,(h(!0),g(q,null,A(z(S),(e=>(h(),g("option",{value:`${e.build_num} ${e.name}`},P(e.build_num)+"-"+P(e.name),9,["value"])))),256))],512),[[O,z(Ae).artifact_name]])])])),_:1})])),_:1})])]),j("div",re,[ce,j("div",ne,[j(_,null,{default:V((()=>[j(b,null,{default:V((()=>[j("div",ue,[U(j("select",{"onUpdate:modelValue":f[6]||(f[6]=e=>z(Ae).edge_id=e)},[pe,(h(!0),g(q,null,A(z($),(e=>(h(),g("option",{disabled:1!==e.health,value:e.edge_id},P(e.esn?e.esn:e.ip)+"("+P(1!==e.health?"异常":"正常")+")",9,["disabled","value"])))),256))],512),[[O,z(Ae).edge_id]])])])),_:1})])),_:1})])]),""===z(Ae).edge_id?(h(),g("div",ve,[me,j("div",fe,[j(_,null,{default:V((()=>[j(b,null,{default:V((()=>[j("div",be,[U(j("select",{"onUpdate:modelValue":f[7]||(f[7]=e=>z(Ae).model=e)},[_e,(h(!0),g(q,null,A(z(D),(e=>(h(),g("option",{value:e.id},P(e.name),9,["value"])))),256))],512),[[O,z(Ae).model]])])])),_:1})])),_:1})])])):k("",!0),""===z(Ae).edge_id?(h(),g("div",ye,[he,j("div",ge,[j(_,null,{default:V((()=>[j(b,null,{default:V((()=>[j(B,{modelValue:z(Ae).data_set,"onUpdate:modelValue":f[8]||(f[8]=e=>z(Ae).data_set=e),mode:"multiple",options:Pe,placeholder:"Select options"},null,8,["modelValue"])])),_:1})])),_:1})])])):k("",!0),k("",!0),j("div",je,[Ve,j("div",ze,[j(_,null,{default:V((()=>[j(b,null,{default:V((()=>[j(F,null,{default:V((()=>[j(E,{to:{name:"user-projects-projectid-deploys",params:{projectid:z(l).params.projectid}},raised:""},{default:V((()=>[ke])),_:1},8,["to"]),j(M,{size:"small",active:m.value},{default:V((()=>[j(E,{disabled:m.value,onClick:f[10]||(f[10]=e=>!m.value&&(m.value=!0,/^[A-z][A-z0-9_\-]+$/.test(Ae.name)?"0"!=Ae.display_type&&Ae.charts.length<1?(t.error("请至少选择一个要显示的图表"),void(m.value=!1)):""===Ae.artifact_name?(t.error("请选择制品包"),void(m.value=!1)):""===Ae.edge_id&&""===Ae.model?(t.error("请选择终端模型"),void(m.value=!1)):void s.dispatch("user/createDeploys",i(i({},Ae),{display_type:Ae.display_type,project_id:l.params.projectid})).then((()=>{t.success("正在部署..."),a.push({name:"user-projects-projectid-deploys",params:{projectid:l.params.projectid}})})).catch((e=>{d.value=e,m.value=!1})):(t.error("名称只能包含大小写字母、减号和下划线"),void(m.value=!1)))),color:"primary",raised:""},{default:V((()=>[xe])),_:1},8,["disabled"])])),_:1},8,["active"])])),_:1})])),_:1})])),_:1})])]),j("div",Ue,[we,j("div",Oe,[j(_,null,{default:V((()=>[j(b,null,{default:V((()=>[d.value?(h(),g(Se,{key:0,color:"danger"},{default:V((()=>[C(P(d.value),1)])),_:1})):k("",!0)])),_:1})])),_:1})])])])])}}});const Ae={class:"page-title has-text-centered"},Pe={class:"menu-toggle has-chevron"},Ce=j("span",{class:"rotate"},[j("i",{class:"icon-line-top"}),j("i",{class:"icon-line-center"}),j("i",{class:"icon-line-bottom"})],-1),Se=j("div",{class:"title-wrap"},[j("h1",{class:"title is-4"},"部署应用")],-1),Be={class:"page-content-inner"},Ee={class:"breadcrumb-box"},Me=j("i",{class:"iconify","data-icon":"feather:corner-down-left"},null,-1);var $e=m({expose:[],setup(e){const l=B(),a=E(),s=M();$({title:"部署应用"}),S((()=>{L.value="projects"}));const t=[{icon:"feather:home",hideLabel:!0,to:{name:"user-projects"}},{label:"项目",to:{name:"user-projects"}},{label:"部署应用"}];return y((()=>{s.dispatch("user/getProject",l.params.projectid)})),(e,l)=>{const s=d,i=qe;return h(),g("div",null,[j("div",Ae,[j("div",{class:"vuero-hamburger nav-trigger push-resize",onClick:l[1]||(l[1]=e=>z(D)("projects"))},[j("span",Pe,[j("span",{class:[["projects"===z(L)&&"active"],"icon-box-toggle"]},[Ce],2)])]),Se]),j("div",Be,[j("div",Ee,[t?(h(),g(s,{key:0,items:t,separator:"bullet","with-icons":""})):k("",!0),j("div",{class:"back-button",onClick:l[2]||(l[2]=()=>z(a).back())},[Me])]),j(i)])])}}});export default $e;
