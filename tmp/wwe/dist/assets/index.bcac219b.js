var e=Object.defineProperty,a=Object.prototype.hasOwnProperty,t=Object.getOwnPropertySymbols,s=Object.prototype.propertyIsEnumerable,r=(a,t,s)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;import{_ as l}from"./V-Breadcrumb.vue_vue&type=script&setup=true&lang.95222eda.js";import{_ as o}from"./V-Button.vue_vue&type=script&setup=true&lang.7d7c3fd2.js";import{a as c,_ as n}from"./V-Field.vue_vue&type=script&setup=true&lang.50df6a27.js";import{_ as i}from"./V-Tag.vue_vue&type=script&setup=true&lang.bf8fa42e.js";import{_ as u}from"./V-IconButton.vue_vue&type=script&setup=true&lang.88eaeff3.js";import{_ as p}from"./V-Buttons.vue_vue&type=script&setup=true&lang.88c78073.js";import{t as d}from"./filters.e49d41fb.js";import{d as m,j as v,k as f,S as b,F as h,i as j,l as _,n as g,m as y,U as x,u as k,B as w,C as V,r as B,v as C,b as q,W as O,E as P,A as z,P as N,Z as S,X as I,$ as A,z as F,O as L}from"./vendor.6243191d.js";import{_ as T}from"./V-FlexTable.vue_vue&type=script&setup=true&lang.19fc13e5.js";import{_ as U}from"./V-Modal.vue_vue&type=script&setup=true&lang.13c249d1.js";import{a as E,c as M,d as R,u as W}from"./index.670b29b2.js";import{u as X}from"./useNotyf.8c9a8697.js";import{_ as Z}from"./V-Loader.vue_vue&type=script&setup=true&lang.152a1df5.js";import{a as $,t as D}from"./activeSidebarState.4b53b430.js";import"./moment.08a7f518.js";const G={class:"flex-table-cell","data-th":"Name"},H={class:"flex-table-cell","data-th":"Name"},J={class:"flex-table-cell","data-th":"Name"},K={class:"flex-table-cell cell-end","data-th":"Actions"};var Q=m({expose:[],props:{rows:{type:Array,required:!0},project:{type:String,required:!0}},setup(e){const a=j("removeBranch");return(t,s)=>{const r=i,l=_("RouterLink"),o=u,c=p;return v(!0),f(h,null,b(e.rows,(t=>(v(),f("div",{key:t.id,class:"flex-table-item"},[g("div",G,[g(l,{to:{name:"user-projects-projectid-files",params:{projectid:e.project},query:{branch:t.name,dir_path:""}}},{default:y((()=>[g(r,{color:"info",label:t.name},null,8,["label"])])),_:2},1032,["to"])]),g("div",H,x(t.commit.message),1),g("div",J,x(k(d)(t.commit.timestamp)),1),g("div",K,[g(c,null,{default:y((()=>[g(o,{onClick:e=>k(a)(t.name),icon:"feather:trash-2",color:"danger",circle:""},null,8,["onClick"])])),_:2},1024)])])))),128)}}});const Y=A();w("data-v-5b81d19f");const ee={class:"page-content-inner"},ae={class:"list-view-toolbar"},te={class:"buttons"},se=P(" 新建分支 "),re=P(" 新建合并请求 "),le=g("div",{class:"flex-table-header"},[g("span",null,"name"),g("span",null,"commit"),g("span",null,"时间"),g("span",{class:"cell-end"},"操作")],-1),oe={class:"form-inner"},ce={class:"field is-horizontal"},ne=g("div",{class:"field-label is-normal"},[g("label",{class:"label required"},"基础分支")],-1),ie={class:"field-body"},ue={key:0,class:"select"},pe={class:"field is-horizontal"},de=g("div",{class:"field-label is-normal"},[g("label",{class:"label required"},"分支名称")],-1),me={class:"field-body"},ve=P("确定");V();var fe=m({expose:[],setup(e){const l=X(),i=E();M();const u=R(),p=B(!1);B(""),B(!1),C((()=>{try{i.query.branch}catch(e){}return""})),C((()=>{try{return Number.parseInt(i.query.dir_path)||1}catch(e){}return 1}));const d=C((()=>u.state.user.branches)),m=C((()=>u.state.user.tags)),j=B([]),_=C((()=>u.state.user.project));C((()=>u.state.channel.user));const y=q({old_branch_name:"master",branch_name:""}),w=()=>{u.dispatch("user/getBranches",{id:i.params.projectid,simple:!1}).then((e=>{console.log("branches.value",d.value),j.value=e.map((e=>"string"==typeof e?e:e.name))}))};F("removeBranch",(e=>{u.dispatch("user/removeBranch",{id:i.params.projectid,name:e}).then((()=>{w(),l.success("删除成功！")}))}));const V=B(!1),A=()=>{V.value||(V.value=!0,u.dispatch("user/createBranch",((e,l)=>{for(var o in l||(l={}))a.call(l,o)&&r(e,o,l[o]);if(t)for(var o of t(l))s.call(l,o)&&r(e,o,l[o]);return e})({id:i.params.projectid},y)).then((()=>{p.value=!1,V.value=!1,w()})).catch((()=>{l.error("创建分支失败"),V.value=!1})))};return O((()=>{u.dispatch("channel/getProfile"),u.dispatch("user/getTags",{id:i.params.projectid,simple:!1}),w()})),(e,a)=>{const t=o,s=c,r=n,l=o,i=Q,u=T,w=c,B=n,C=U;return v(),f("div",null,[g("div",ee,[g("div",ae,[k(d)&&k(m)?(v(),f(r,{key:0,addons:""},{default:Y((()=>[g(s,null,{default:Y((()=>[g(t,{to:{name:"user-projects-projectid-branch",params:{projectid:k(_).project_id}},icon:"feather:git-branch"},{default:Y((()=>[P(" 分支 "+x(k(d).length),1)])),_:1},8,["to"])])),_:1}),g(s,null,{default:Y((()=>[g(t,{light:"",to:{name:"user-projects-projectid-tag",params:{projectid:k(_).project_id}},icon:"feather:tag"},{default:Y((()=>[P(" 标签 "+x(k(m).length),1)])),_:1},8,["to"])])),_:1})])),_:1})):z("",!0),g("div",te,[g(l,{onClick:a[1]||(a[1]=e=>{p.value=!0}),color:"primary",elevated:""},{default:Y((()=>[se])),_:1}),g(l,{to:{name:"user-projects-projectid-pulls-new",params:{projectid:k(_).project_id}},color:"primary",elevated:""},{default:Y((()=>[re])),_:1},8,["to"])])]),k(_).project_id?(v(),f(u,{key:0,compact:""},{header:Y((()=>[le])),body:Y((()=>[g(i,{rows:k(d),project:k(_).project_id},null,8,["rows","project"])])),_:1})):z("",!0),g(C,{open:p.value,size:"large",actions:"center",title:"新建分支",onClose:a[5]||(a[5]=e=>p.value=!1)},{content:Y((()=>[g("div",oe,[g("div",ce,[ne,g("div",ie,[g(B,null,{default:Y((()=>[g(w,null,{default:Y((()=>[j.value?(v(),f("div",ue,[N(g("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>k(y).old_branch_name=e)},[(v(!0),f(h,null,b(j.value,((e,a)=>(v(),f("option",{key:"i",value:e},x(e),9,["value"])))),128))],512),[[S,k(y).old_branch_name]])])):z("",!0)])),_:1})])),_:1})])]),g("div",pe,[de,g("div",me,[g(B,null,{default:Y((()=>[g(w,null,{default:Y((()=>[N(g("input",{class:"input",type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>k(y).branch_name=e),placeholder:"请输入分支名称"},null,512),[[I,k(y).branch_name]])])),_:1})])),_:1})])])])])),action:Y((()=>[g(l,{color:"primary",loading:V.value,onClick:a[4]||(a[4]=e=>A()),raised:""},{default:Y((()=>[ve])),_:1},8,["loading"])])),_:1},8,["open"])])])}}});fe.__scopeId="data-v-5b81d19f";const be={class:"page-title has-text-centered"},he={class:"menu-toggle has-chevron"},je=g("span",{class:"rotate"},[g("i",{class:"icon-line-top"}),g("i",{class:"icon-line-center"}),g("i",{class:"icon-line-bottom"})],-1),_e=g("div",{class:"title-wrap"},[g("h1",{class:"title is-4"},"分支管理")],-1),ge={class:"page-content-inner"},ye={class:"breadcrumb-box"},xe=g("i",{class:"iconify","data-icon":"feather:corner-down-left"},null,-1);var ke=m({expose:[],setup(e){const a=E(),t=M(),s=R(),r=B(!0);W({title:"分支管理"}),L((()=>{$.value="projects"})),B(!1);const o=C((()=>s.state.user.project));C((()=>s.state.channel.user));const c=B();return O((()=>{Promise.all([s.dispatch("user/getProject",a.params.projectid)]).then((()=>{c.value=[{icon:"feather:home",hideLabel:!0,to:{name:"user-projects"}},{label:"项目列表",to:{name:"user-projects"}},{label:o.value.repo_name,to:{name:"user-projects-projectid-files",params:{projectid:o.value.project_id}}},{label:"分支管理"}],r.value=!1}))})),(e,a)=>{const s=l,o=fe,n=Z;return v(),f("div",null,[g("div",be,[g("div",{class:"vuero-hamburger nav-trigger push-resize",onClick:a[1]||(a[1]=e=>k(D)("projects"))},[g("span",he,[g("span",{class:[["projects"===k($)&&"active"],"icon-box-toggle"]},[je],2)])]),_e]),g("div",ge,[g(n,{size:"large",active:r.value},{default:y((()=>[g("div",ye,[c.value?(v(),f(s,{key:0,items:c.value,separator:"bullet","with-icons":""},null,8,["items"])):z("",!0),g("div",{onClick:a[2]||(a[2]=()=>k(t).back())},[xe])]),g(o)])),_:1},8,["active"])])])}}});export default ke;
