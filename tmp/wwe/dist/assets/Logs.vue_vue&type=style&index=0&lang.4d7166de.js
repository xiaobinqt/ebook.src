import{d as e,r as l,O as a,f as s,j as o,k as t,P as n,a3 as r,n as c,u as i,F as u,S as d,A as v,U as p}from"./vendor.6243191d.js";import{c as f}from"./activePanelState.21033cba.js";import{t as g}from"./filters.e49d41fb.js";const m=c("i",{class:"iconify","data-icon":"feather:arrow-up-circle"},null,-1),y=c("i",{class:"iconify","data-icon":"feather:arrow-down-circle"},null,-1),S={key:0,class:"log-container"};var h=e({expose:[],props:{id:{type:String,required:!0}},setup(e){const{id:h,type:b}=e;let k;const w=l([]),j=l(null),E=l(0);let T=!0,H=null;const L=l(!1),q=l(!0),x=()=>{null!=H&&(E.value=H.scrollTop,E.value<10?(L.value=!1,q.value=!0):L.value=!0,E.value>H.scrollHeight-H.offsetHeight-20?(L.value=!0,q.value=!1):q.value=!0)},A=()=>{T&&window.requestAnimationFrame((()=>{x(),T=!1})),T=!0},C=()=>{H&&(H.scrollTop=H.scrollHeight-H.offsetHeight,x())};return a((()=>{h&&(k=new EventSource(`/api/instances/${h}/logs?token=${localStorage.getItem("token")}`),k.addEventListener("logs",(function(e){const l=e.data.replace(/^([\s\S]*?)20(?=(\d*-){2}\d*T)/,"20").split(" "),a=l[0],s=l.slice(1).join(" ");w.value=[...w.value,{date:g(a),log:s}],setTimeout((()=>{C()}),0)})),k.addEventListener("error",(function(e){k.close()})),j.value&&(H=j.value,H.addEventListener("scroll",A)))})),s((()=>{k&&(console.log("ed close",k),k.close(),console.log("es.readyState",k.readyState)),H&&H.removeEventListener("scroll",A)})),(e,l)=>(o(),t("div",{class:"logs-body has-slimscroll",ref:j},[n(c("a",{onClick:l[1]||(l[1]=e=>{H&&(H.scrollTop=0,x())}),class:"top-button"},[m],512),[[r,L.value]]),n(c("a",{onClick:l[2]||(l[2]=e=>C()),class:"bottom-button"},[y],512),[[r,q.value]]),i(f)?(o(),t("div",S,[(o(!0),t(u,null,d(w.value,(e=>(o(),t("div",null,p(e.date)+p(e.log),1)))),256))])):v("",!0)],512))}});export{h as _};
