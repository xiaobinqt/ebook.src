import{_ as e}from"./V-Breadcrumb.vue_vue&type=script&setup=true&lang.95222eda.js";import{_ as s}from"./V-Tag.vue_vue&type=script&setup=true&lang.bf8fa42e.js";import{m as a,t}from"./filters.e49d41fb.js";import{d as l,r,j as n,k as o,n as i,A as c,E as u,U as d,u as p,O as v,F as m,S as b,v as f,a as g,W as y,f as h,m as j}from"./vendor.6243191d.js";import{_ as k}from"./V-Button.vue_vue&type=script&setup=true&lang.7d7c3fd2.js";import{_}from"./V-Tabs.vue_vue&type=script&setup=true&lang.33403b64.js";import{a as x,c as w,d as V,u as C}from"./index.670b29b2.js";import"./useNotyf.8c9a8697.js";import{_ as E}from"./V-Loader.vue_vue&type=script&setup=true&lang.152a1df5.js";import{a as B,t as I}from"./activeSidebarState.4b53b430.js";import"./moment.08a7f518.js";import"./V-Icon.vue_vue&type=script&setup=true&lang.7e1a2cfa.js";const S={class:"step-box"},T={key:0,class:"status-icon success"},$=i("i",{class:"iconify","data-icon":"feather:check"},null,-1),q={key:1,class:"status-icon failed"},z=i("i",{class:"iconify","data-icon":"feather:x"},null,-1),L={key:2,class:"status-icon doing"},R=i("i",{class:"iconify","data-icon":"feather:play"},null,-1),A={key:3,class:"status-icon"},O=i("i",{class:"iconify","data-icon":"feather:more-horizontal"},null,-1),P={key:0},U=i("i",{class:"iconify","data-icon":"feather:chevron-right"},null,-1),F={key:1},H=i("i",{class:"iconify","data-icon":"feather:chevron-down"},null,-1),M={key:0,class:"pre-box"};var X=l({expose:[],props:{step:{type:Object,required:!0}},setup(e){const s=r(!1);return(t,l)=>(n(),o("div",S,[i("div",{class:"step-header",onClick:l[1]||(l[1]=e=>{s.value=!s.value})},[i("div",null,["success"===e.step.status?(n(),o("span",T,[$])):"failed"===e.step.status?(n(),o("span",q,[z])):"doing"===e.step.status?(n(),o("span",L,[R])):"unexec"===e.step.status?(n(),o("span",A,[O])):c("",!0),u(" "+d(e.step.name.substr(0,108)+(e.step.name.length>108?"...":"")),1)]),i("div",null,[u(d(p(a)(e.step.run_time_millis))+" ",1),s.value?c("",!0):(n(),o("b",P,[U])),s.value?(n(),o("b",F,[H])):c("",!0)])]),s.value?(n(),o("div",M,[i("pre",null,d(e.step.output.map((e=>e.message)).join("")),1)])):c("",!0)]))}});const D={class:"stage-box"},N={class:"stage"};var W=l({expose:[],props:{stages:{type:Array,required:!0}},setup:e=>(v((()=>{})),(s,a)=>{const t=X;return n(),o("div",D,[(n(!0),o(m,null,b(e.stages,((e,s)=>(n(),o("div",N,[i("h4",null,d(e.name),1),i("div",null,[(n(!0),o(m,null,b(e.steps,((e,s)=>(n(),o(t,{key:s,step:e},null,8,["step"])))),128))])])))),256))])})});const G={key:0},J={class:"builder-card"},K={class:"builder-head"},Q={class:"builder-info"},Y=u(" 分支 / 镜像Tag："),Z=u(" 开始时间："),ee=u(" 构建时长："),se=u(" CPU / OS："),ae={class:"builder-info"},te=u(" 描述："),le={key:0,class:"builder-card tabs-box"},re={key:0,style:{"padding-top":"30px"}},ne={key:1,style:{"padding-top":"30px"}},oe={class:"artifacts-list"},ie={class:"artifact"},ce=i("i",{class:"iconify","data-icon":"feather:package"},null,-1),ue=u(" 下载 "),de={key:2},pe={class:"artifacts-list"},ve={class:"image-list"},me={key:3},be={class:"info-table"},fe={class:"info-table-row"},ge={class:"info-table-label"},ye={class:"info-table-content"},he={key:4},je={class:"pre-box"};var ke=l({expose:[],setup(e){const l=x();w();const v=V(),C=f((()=>v.state.user.builder)),E=f((()=>v.state.user.project)),B=r([]);g([C,E],(([e,s])=>{const a=[{label:"步骤",value:"steps"}];console.log("newBuilder",e),e.artifacts&&a.push({label:"制品包",value:"artifacts"}),B.value=a,console.log("tabs",B)}));let I=0;y((()=>{console.log("builder",C),I=window.setInterval((()=>{v.dispatch("user/getBuilder",{id:l.params.projectid,number:l.params.number}).then((()=>{console.log("builder",C),"doing"!==C.value.status&&window.clearInterval(I)}))}),3e3)})),h((()=>{window.clearInterval(I)}));const S=(e,s,a)=>{const t=new XMLHttpRequest;t.open("get",`/api/projects/${l.params.projectid}/jobs/${s}/artifacts/${a}`,!0),t.responseType="blob",t.setRequestHeader("X-Token",localStorage.getItem("token")),t.onload=function(){if(console.log(t),200===this.status){const e=this.response,s=new FileReader;s.readAsDataURL(e),s.onload=function(e){const s=document.createElement("a");s.download=a,s.href=e.target.result;const t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),s.dispatchEvent(t)}}},t.send()};return(e,r)=>{const v=s,f=W,g=k,y=_;return p(C)?(n(),o("div",G,[i("div",J,[i("div",K,[i("h3",null,[u(d(p(C).name)+" ",1),"success"===p(C).status?(n(),o(v,{key:0,color:"success",label:"成功",rounded:""})):c("",!0),"failed"===p(C).status?(n(),o(v,{key:1,color:"danger",label:"失败",rounded:""})):c("",!0),"created"===p(C).status?(n(),o(v,{key:2,label:"已创建",rounded:""})):c("",!0),"doing"===p(C).status?(n(),o(v,{key:3,color:"warning",label:"构建中",rounded:""})):c("",!0),"cancel"===p(C).status?(n(),o(v,{key:4,label:"已取消",rounded:""})):c("",!0)]),i("div",Q,[Y,i("strong",null,d(p(C).branch)+" / "+d(p(C).tag),1),Z,i("strong",null,d(p(t)(p(C).start_time)),1),ee,i("strong",null,d(p(a)(p(C).run_time_millis)),1),se,i("strong",null,d(p(C).cpu)+" / "+d(p(C).os),1)]),i("div",ae,[te,i("strong",null,d(p(C).desc),1)])])]),B.value.length?(n(),o("div",le,[i(y,{slider:"",type:"rounded",align:"centered",selected:"steps",tabs:B.value},{tab:j((({activeValue:e})=>["steps"===e?(n(),o("div",re,[p(C).stages?(n(),o(f,{key:`${p(E).project_id}_${p(C).number}`,stages:p(C).stages},null,8,["stages"])):c("",!0)])):"artifacts"===e?(n(),o("div",ne,[i("ul",oe,[(n(!0),o(m,null,b(p(C).artifacts,(e=>(n(),o("li",null,[i("div",ie,[ce,u(" "+d(e),1)]),i("div",null,[i(g,{onClick:s=>S(p(l).params.projectid,p(C).number,e),color:"success",icon:"feather:download-cloud",raised:"",rounded:""},{default:j((()=>[ue])),_:2},1032,["onClick"])])])))),256))])])):"images"===e?(n(),o("div",de,[i("ul",pe,[i("li",null,[i("div",ve,[i("h5",null,d(p(E).namespace)+"/"+d(p(E).image_name),1),i("div",null,d(p(C).image_name),1)]),c("",!0)])])])):"args"===e?(n(),o("div",me,[i("div",be,[(n(!0),o(m,null,b(p(C).customize_args,((e,s)=>(n(),o("div",fe,[i("div",ge,d(s),1),i("div",ye,d(e),1)])))),256))])])):"dockerfile"===e?(n(),o("div",he,[i("div",je,[i("pre",null,d(p(C).df_content),1)])])):c("",!0)])),_:1},8,["tabs"])])):c("",!0)])):c("",!0)}}});const _e={class:"page-title has-text-centered"},xe={class:"menu-toggle has-chevron"},we=i("span",{class:"rotate"},[i("i",{class:"icon-line-top"}),i("i",{class:"icon-line-center"}),i("i",{class:"icon-line-bottom"})],-1),Ve={class:"title-wrap"},Ce={key:0,class:"title is-4"},Ee={class:"page-content-inner"},Be={class:"breadcrumb-box"},Ie=i("i",{class:"iconify","data-icon":"feather:corner-down-left"},null,-1);var Se=l({expose:[],setup(s){const a=x(),t=w(),l=V(),u=r(!0);C({title:"构建详情"}),v((()=>{B.value="projects"}));const m=f((()=>l.state.user.project)),b=f((()=>l.state.user.builder)),g=r();return y((()=>{console.log("route.params",a.params),Promise.all([l.dispatch("user/getProject",a.params.projectid),l.dispatch("user/getBuilder",{id:a.params.projectid,number:a.params.number})]).then((()=>{g.value=[{icon:"feather:home",hideLabel:!0,to:{name:"user-projects"}},{label:"项目列表",to:{name:"user-projects"}},{label:m.value.repo_name,to:{name:"user-projects-projectid-files",params:{projectid:a.params.projectid}}},{label:"持续集成",to:{name:"user-projects-projectid-builds",params:{projectid:a.params.projectid}}},{label:b.value.name}],u.value=!1}))})),(s,a)=>{const l=e,r=ke,v=E;return n(),o("div",null,[i("div",_e,[i("div",{class:"vuero-hamburger nav-trigger push-resize",onClick:a[1]||(a[1]=e=>p(I)("projects"))},[i("span",xe,[i("span",{class:[["projects"===p(B)&&"active"],"icon-box-toggle"]},[we],2)])]),i("div",Ve,[p(m)?(n(),o("h1",Ce,d(p(m).repo_name),1)):c("",!0)])]),i("div",Ee,[i(v,{size:"large",active:u.value},{default:j((()=>[i("div",Be,[g.value?(n(),o(l,{key:0,items:g.value,separator:"bullet","with-icons":""},null,8,["items"])):c("",!0),i("div",{class:"back-button",onClick:a[2]||(a[2]=()=>p(t).back())},[Ie])]),i(r)])),_:1},8,["active"])])])}}});export default Se;
