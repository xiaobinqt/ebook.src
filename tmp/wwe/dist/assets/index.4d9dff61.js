import{_ as e}from"./V-Breadcrumb.vue_vue&type=script&setup=true&lang.95222eda.js";import{_ as t}from"./Eventsource.vue_vue&type=script&setup=true&lang.2ffe835f.js";import{a,_ as s}from"./V-Field.vue_vue&type=script&setup=true&lang.50df6a27.js";import{_ as r}from"./V-Button.vue_vue&type=script&setup=true&lang.7d7c3fd2.js";import{d as o,j as i,k as l,S as c,F as n,l as p,n as d,A as u,m,E as h,U as v,B as j,C as _,r as f,v as g,a as y,W as b,u as k,a6 as w,P as q,$ as x,Q as $,O as E,o as P}from"./vendor.6243191d.js";import{_ as S}from"./V-FlexTable.vue_vue&type=script&setup=true&lang.19fc13e5.js";import{_ as V}from"./V-Modal.vue_vue&type=script&setup=true&lang.13c249d1.js";import{a as D,c as M,d as B,u as C}from"./index.670b29b2.js";import{u as L}from"./useNotyf.8c9a8697.js";import{_ as F}from"./V-Loader.vue_vue&type=script&setup=true&lang.152a1df5.js";import{a as I,t as T}from"./activeSidebarState.4b53b430.js";const U={class:"flex-table-cell file-name-link","data-th":"Name"},z={key:0,class:"fas fa-folder"},A={key:1,class:"fas fa-file-alt"};var N=o({expose:[],props:{rows:{type:Array,required:!0},branch:{type:String,required:!0},project:{type:String,required:!0}},setup:e=>(t,a)=>{const s=p("RouterLink");return i(!0),l(n,null,c(e.rows,(t=>(i(),l("div",{key:t.id,class:"flex-table-item"},[d("div",U,["dir"===t.type?(i(),l("i",z)):u("",!0),"file"===t.type?(i(),l("i",A)):u("",!0),"dir"===t.type?(i(),l(s,{key:2,to:{name:"user-projects-projectid-files",params:{projectid:e.project},query:{branch:e.branch,dir_path:t.path}}},{default:m((()=>[h(v(t.name),1)])),_:2},1032,["to"])):u("",!0),"file"===t.type?(i(),l(s,{key:3,to:{name:"user-projects-projectid-file",params:{projectid:e.project},query:{branch:e.branch,filepath:t.path}}},{default:m((()=>[h(v(t.name),1)])),_:2},1032,["to"])):u("",!0)])])))),128)}});const R=x();j("data-v-5e5e9c0e");const W={class:"page-content-inner"},O={class:"list-view-toolbar"},Q=h(" 合并请求 "),G={key:1,class:"path-info"},H={key:0},J=d("em",null,"/",-1),K={key:2,class:"buttons"},X=d("div",{id:"show",style:{color:"red"}},"初始化环境失败, 系统正在重新创建，若再次失败请联系管理员",-1),Y={class:"list-view-toolbar"},Z=d("div",{class:"flex-table-header"},[d("span",{class:"flex-grow-short"},"name")],-1),ee=h("适配");_();var te=o({expose:[],setup(e){const o=L(),m=D();M();const j=B(),_=f(!1),x=f(!1),E=g((()=>m.query.branch||"master")),P=g((()=>m.query.dir_path||""));y([E,P],((e,t)=>{m.params.projectid&&j.dispatch("user/getProjectFiles",{id:m.params.projectid,branch:E.value,dir_path:P.value})}));const C=g((()=>j.state.user.files)),F=g((()=>j.state.user.project)),I=g((()=>j.getters["user/getSimpleBranches"])),T=g((()=>j.state.user.tags)),U=g((()=>j.state.channel.user));f(!1);b((()=>{j.dispatch("channel/getProfile"),j.dispatch("user/getProjectFiles",{id:m.params.projectid,branch:E.value,dir_path:P.value}),j.dispatch("user/getBranches",{id:m.params.projectid,simple:!1}),j.dispatch("user/getTags",{id:m.params.projectid,simple:!1})}));const z=e=>{console.log("attach_disk data::",e),"successed"===e.status&&j.dispatch("channel/getProfile").then((e=>{x.value&&(x.value=!1,j.dispatch("user/getEditerUrl",{id:m.params.projectid}).then((e=>{const t=`${e.msg}${/\?/.test(e.msg)?"&":"?"}project_id=${m.params.projectid}`;window.open(t,"_blank")})))}))};return(e,f)=>{const g=t,y=p("Multiselect"),b=a,P=s,D=r,M=a,B=s,L=p("RouterLink"),A=r,te=N,ae=S,se=V,re=$("tooltip");return i(),l("div",null,[d(g,{topic:"attach_disk",onmessage:z}),d("div",W,[d("div",O,[d(P,{class:"is-autocomplete-select"},{default:R((()=>[d(b,{icon:"feather:search"},{default:R((()=>[d(y,{modelValue:k(E),"onUpdate:modelValue":f[1]||(f[1]=e=>w(E)?E.value=e:null),options:k(I),placeholder:"Search Branch...",searchable:!0},null,8,["modelValue","options"])])),_:1})])),_:1}),k(I)&&k(T)?(i(),l(B,{key:0,addons:""},{default:R((()=>[d(M,null,{default:R((()=>[d(D,{to:{name:"user-projects-projectid-branch",params:{projectid:k(F).project_id}},icon:"feather:git-branch"},{default:R((()=>[h(" 分支 "+v(k(I).length),1)])),_:1},8,["to"])])),_:1}),d(M,null,{default:R((()=>[d(D,{to:{name:"user-projects-projectid-tag",params:{projectid:k(F).project_id}},icon:"feather:tag"},{default:R((()=>[h(" 标签 "+v(k(T).length),1)])),_:1},8,["to"])])),_:1}),d(M,null,{default:R((()=>[d(D,{to:{name:"user-projects-projectid-pulls",params:{projectid:k(F).project_id}},icon:"feather:git-pull-request"},{default:R((()=>[Q])),_:1},8,["to"])])),_:1})])),_:1})):u("",!0),k(m).query.dir_path?(i(),l("div",G,[d(L,{to:{name:"user-projects-projectid-files",params:{projectid:k(F).project_id},query:{dir_path:""}}},{default:R((()=>[h(v(k(F).repo_name),1)])),_:1},8,["to"]),k(m).query.dir_path?(i(),l("em",H,"/")):u("",!0),k(m).query.dir_path?(i(!0),l(n,{key:1},c(k(m).query.dir_path.split("/"),(t=>(i(),l("span",null,[d(L,{to:{name:"user-projects-projectid-files",params:{projectid:k(F).project_id},query:{dir_path:k(m).query.dir_path.split("/").slice(0,e.i+1).join("/")}}},{default:R((()=>[h(v(t),1)])),_:2},1032,["to"]),J])))),256)):u("",!0)])):u("",!0),k(F)?(i(),l("div",K,[q(d(A,{onClick:f[2]||(f[2]=e=>(x.value=!0,void(1===U.value.init_status&&U.value.edge_id?j.dispatch("user/getEditerUrl",{id:m.params.projectid}).then((e=>{x.value=!1;const t=`${e.msg}${/\?/.test(e.msg)?"&":"?"}project_id=${m.params.projectid}`;window.open(t,"_blank")}),(()=>{x.value=!1})):j.dispatch("channel/getProfile").then((e=>{e.last_init<Math.round(new Date/1e3)?(document.querySelector("#show").style.display="block",o.warning(`环境正在初始化，${Math.round(new Date/1e3)+360-Math.round(new Date/1e3)}秒后创建成功`),j.dispatch("user/resetMachine",U.value.edge_id).then((e=>{j.dispatch("channel/getProfile").then((e=>{setTimeout((()=>{document.querySelector("#show").style.display="none"}),4e4)}))}))):o.warning(`环境正在初始化，${e.last_init-Math.round(new Date/1e3)}秒后创建成功`)}))))),color:"primary",elevated:""},{default:R((()=>[h(v(1!==k(F).level?"WebIDE":"可视化IDE"),1)])),_:1},512),[[re,"IDE将会在新的窗口中打开，请勿阻止浏览器弹窗",void 0,{left:!0,warning:!0}]])])):u("",!0)]),X,d("div",Y,[d("p",null,v(k(F).desc),1)]),k(F).project_id?(i(),l(ae,{key:0,compact:""},{header:R((()=>[Z])),body:R((()=>[d(te,{rows:k(C),branch:k(E),project:k(F).project_id},null,8,["rows","branch","project"])])),_:1})):u("",!0),d(se,{open:_.value,size:"large",actions:"center",title:"开始适配",onClose:f[3]||(f[3]=e=>_.value=!1)},{content:R((()=>[])),action:R((()=>[d(A,{color:"primary",raised:""},{default:R((()=>[ee])),_:1})])),_:1},8,["open"])])])}}});te.__scopeId="data-v-5e5e9c0e";const ae={class:"page-title has-text-centered"},se={class:"menu-toggle has-chevron"},re=d("span",{class:"rotate"},[d("i",{class:"icon-line-top"}),d("i",{class:"icon-line-center"}),d("i",{class:"icon-line-bottom"})],-1),oe=d("div",{class:"title-wrap"},[d("h1",{class:"title is-4"},"代码管理")],-1),ie={class:"page-content-inner"},le={class:"breadcrumb-box"},ce=d("i",{class:"iconify","data-icon":"feather:corner-down-left"},null,-1),ne={key:0,class:"public-key-box"},pe={class:"pre-box"};var de=o({expose:[],setup(t){const a=L(),s=D(),r=M(),o=B(),c=f(!0);C({title:"代码管理"}),E((()=>{}));const n=f(!1),p=g((()=>o.state.user.project)),h=g((()=>o.state.channel.user)),j=f();b((()=>{Promise.all([o.dispatch("user/getProject",s.params.projectid)]).then((()=>{I.value=2===p.value.level?"none":"projects",j.value=[{icon:"feather:home",hideLabel:!0,to:{name:"user-projects"}},{label:"项目列表",to:{name:"user-projects"}},{label:p.value.repo_name,to:{name:"user-projects-projectid-files",params:{projectid:s.params.projectid}}},{label:"代码管理"}],c.value=!1}))}));let _=0;const y=e=>{"Period"===e.code&&(window.clearTimeout(_),_=setTimeout((()=>{1===h.value.init_status&&h.value.edge_id?o.dispatch("user/getEditerUrl",{id:s.params.projectid}).then((e=>{const t=`${e.msg}${/\?/.test(e.msg)?"&":"?"}project_id=${s.params.projectid}&token=${localStorage.getItem("token")}`;window.open(t,"_blank")})):a.warning("环境没有初始化，请稍候尝试！")}),500))};return E((()=>{document.addEventListener("keydown",y)})),P((()=>{document.removeEventListener("keydown",y)})),(t,a)=>{const s=e,o=te,h=F,_=V;return i(),l("div",null,[d("div",ae,[d("div",{class:"vuero-hamburger nav-trigger push-resize",onClick:a[1]||(a[1]=e=>{p.value&&2===p.value.level?T("none"):T("projects")})},[d("span",se,[d("span",{class:[["projects"===k(I)&&"active"],"icon-box-toggle"]},[re],2)])]),oe]),d("div",ie,[d(h,{size:"large",active:c.value},{default:m((()=>[d("div",le,[j.value?(i(),l(s,{key:0,items:j.value,separator:"bullet","with-icons":""},null,8,["items"])):u("",!0),d("div",{onClick:a[2]||(a[2]=()=>k(r).back())},[ce])]),d(o)])),_:1},8,["active"])]),d(_,{open:n.value,size:"large",actions:"center",title:"查看公钥",onClose:a[3]||(a[3]=e=>n.value=!1)},{content:m((()=>[k(p).deploy_key?(i(),l("div",ne,[d("div",pe,[d("pre",null,v(k(p).deploy_key.public_key),1)])])):u("",!0)])),action:m((()=>[])),_:1},8,["open"])])}}});export default de;
