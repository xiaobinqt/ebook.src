var e=Object.defineProperty,a=Object.prototype.hasOwnProperty,t=Object.getOwnPropertySymbols,l=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,r=(e,r)=>{for(var i in r||(r={}))a.call(r,i)&&s(e,i,r[i]);if(t)for(var i of t(r))l.call(r,i)&&s(e,i,r[i]);return e};import{_ as i}from"./V-Breadcrumb.vue_vue&type=script&setup=true&lang.95222eda.js";import{_ as o,a as c}from"./V-Field.vue_vue&type=script&setup=true&lang.50df6a27.js";import{_ as n}from"./V-Button.vue_vue&type=script&setup=true&lang.7d7c3fd2.js";import{_ as u}from"./V-FlexNone.vue_vue&type=script&setup=true&lang.cbed393c.js";import{_ as p}from"./V-Desc.vue_vue&type=style&index=0&media=screen&lang.a15b66b4.js";import{d,j as m,k as v,S as f,F as b,n as g,U as _,r as h,v as y,b as j,a as x,W as k,u as V,m as z,A as w,P as N,X as P,Z as I,E as O,O as C}from"./vendor.6243191d.js";import{_ as S}from"./V-FlexTable.vue_vue&type=script&setup=true&lang.19fc13e5.js";import{_ as U}from"./V-FlexPagination.vue_vue&type=script&setup=true&lang.036e60ba.js";import{_ as q}from"./V-Modal.vue_vue&type=script&setup=true&lang.13c249d1.js";import{_ as F}from"./V-PlaceholderSection.vue_vue&type=script&setup=true&lang.67c36c04.js";import{a as R,c as B,d as A,u as $}from"./index.670b29b2.js";import{u as E}from"./useNotyf.8c9a8697.js";import{_ as L}from"./V-Loader.vue_vue&type=script&setup=true&lang.152a1df5.js";import{a as D,t as M}from"./activeSidebarState.4b53b430.js";const T={class:"flex-table-cell","data-th":"Name"},W={class:"flex-table-cell","data-th":"Name"},X={class:"flex-table-cell","data-th":"Name"},Z={class:"flex-table-cell","data-th":"Name"},G={class:"flex-table-cell","data-th":"Name"},H={class:"flex-table-cell","data-th":"Name"};var J=d({expose:[],props:{rows:{type:Array,required:!0}},setup:e=>(a,t)=>{const l=p;return m(!0),v(b,null,f(e.rows,(e=>(m(),v("div",{key:e.id,class:"flex-table-item"},[g("div",T,_(e.name),1),g("div",W,_(e.tag),1),g("div",X,_(e.build_num),1),g("div",Z,_(e.artifact_name),1),g("div",G,[g(l,{content:e.desc},null,8,["content"])]),g("div",H,_(e.create_time),1)])))),128)}});const K={key:0},Q={class:"list-view-toolbar"},Y={class:"buttons"},ee=O("发布新版本"),ae={class:"page-content-inner"},te=g("div",{class:"flex-table-header"},[g("span",null,"名称"),g("span",null,"版本"),g("span",null,"构建编号"),g("span",null,"制品包"),g("span",null,"描述"),g("span",null,"创建时间")],-1),le={class:"field is-horizontal"},se=g("div",{class:"field-label is-normal"},[g("label",{class:"label required"},"版本标签")],-1),re={class:"field-body"},ie={class:"field is-horizontal"},oe=g("div",{class:"field-label is-normal"},[g("label",{class:"label required"},"版本标题")],-1),ce={class:"field-body"},ne={class:"field is-horizontal"},ue=g("div",{class:"field-label is-normal"},[g("label",{class:"label"},"版本描述")],-1),pe={class:"field-body"},de={class:"field is-horizontal"},me=g("div",{class:"field-label is-normal"},[g("label",{class:"label required"},"选择制品包")],-1),ve={class:"field-body"},fe={class:"select"},be=g("option",{value:""},"请选择制品包",-1),ge=g("i",{class:"fas fa-spinner fa-pulse"},null,-1),_e=O(" 确定 "),he=O("确认");var ye=d({expose:[],props:{audit:{type:Boolean,default:!1}},setup(e){const a=R(),t=B(),l=A(),s=E(),i=h(!1);h(!1),h(),h();const p=h(!1),d=h(""),O=h(!1),C=y((()=>{try{return Number.parseInt(a.query.page)||1}catch(e){}return 1})),$=y((()=>l.state.user.releases)),L=y((()=>l.state.user.artifacts)),D=j({project_id:a.params.projectid,name:"",desc:"",tag:"",artifact_name:"",build_num:""}),M=()=>{L.value&&0===L.value.length?s.error("当前项目还没有制品包"):i.value=!0};return x([d,C],((e,s)=>{e[0]!==s[0]&&(t.push("releases"),l.dispatch("user/getReleases",{projectId:a.params.projectid,page:1,size:10,search:e[0]})),e[1]!==s[1]&&l.dispatch("user/getReleases",{projectId:a.params.projectid,page:C.value,size:10,search:e[0]})})),k((async()=>{l.dispatch("user/getArtfacts",{id:a.params.projectid}),l.dispatch("user/getReleases",{projectId:a.params.projectid,page:1,size:10})})),(e,t)=>{const h=c,y=o,j=n,x=u,k=J,R=S,B=U,A=n,E=q,T=F,W=q;return V($)&&V($).page_info?(m(),v("div",K,[g("div",Q,[g(y,null,{default:z((()=>[g(h,{icon:"feather:search"},{default:z((()=>[N(g("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>d.value=e),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[P,d.value]])])),_:1})])),_:1}),g("div",Y,[g(j,{color:"primary",onClick:M,raised:""},{default:z((()=>[ee])),_:1})])]),g("div",ae,[V($)&&0===V($).data.length?(m(),v(x,{key:0,title:"没有数据",subtitle:"当前没有要显示的数据"})):(m(),v(R,{key:1,compact:""},{header:z((()=>[te])),body:z((()=>[g(k,{rows:V($).data},null,8,["rows"])])),_:1})),V($).page_info.count?(m(),v(B,{key:2,"item-per-page":V($).page_info.size,"total-items":V($).page_info.count,"current-page":V(C),"max-links-displayed":5},null,8,["item-per-page","total-items","current-page"])):w("",!0)]),g(E,{open:i.value,size:"large",actions:"center",title:"发布版本",onClose:t[7]||(t[7]=e=>(i.value=!1,D.name="",D.tag="",D.desc="",void(D.artifact_name="")))},{content:z((()=>[g("div",null,[g("div",le,[se,g("div",re,[g(y,null,{default:z((()=>[g(h,null,{default:z((()=>[N(g("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>V(D).tag=e),class:"input",type:"text",placeholder:"请输入版本信息"},null,512),[[P,V(D).tag]])])),_:1})])),_:1})])]),g("div",ie,[oe,g("div",ce,[g(y,null,{default:z((()=>[g(h,null,{default:z((()=>[N(g("input",{class:"input",type:"text",placeholder:"请输入版本标题","onUpdate:modelValue":t[3]||(t[3]=e=>V(D).name=e)},null,512),[[P,V(D).name]])])),_:1})])),_:1})])]),g("div",ne,[ue,g("div",pe,[g(y,null,{default:z((()=>[g(h,null,{default:z((()=>[N(g("textarea",{class:"textarea",rows:"6",placeholder:"请输入设备描述","onUpdate:modelValue":t[4]||(t[4]=e=>V(D).desc=e)},"\n              ",512),[[P,V(D).desc]])])),_:1})])),_:1})])]),g("div",de,[me,g("div",ve,[g(y,null,{default:z((()=>[g(h,null,{default:z((()=>[g("div",fe,[N(g("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>V(D).artifact_name=e)},[be,(m(!0),v(b,null,f(V(L),(e=>(m(),v("option",{value:`${e.build_num} ${e.name}`},_(e.build_num)+"-"+_(e.name),9,["value"])))),256))],512),[[I,V(D).artifact_name]])])])),_:1})])),_:1})])])])])),action:z((()=>[O.value?(m(),v(A,{key:0,color:"primary"},{default:z((()=>[ge])),_:1})):(m(),v(A,{key:1,color:"primary",onClick:t[6]||(t[6]=e=>{/\d+\.\d+\.\d+/.test(D.tag)?$.value.data[0]&&D.tag<=$.value.data[0].tag?s.error(`请输入大于${$.value.data[0].tag}的版本`):""!==D.name?""!==D.artifact_name?(O.value=!0,l.dispatch("user/createRelease",r(r({projectId:a.params.projectid},D),{artifact_name:D.artifact_name.substring(2),build_num:D.artifact_name.substring(0,1)})).then((()=>{s.success("发布成功"),i.value=!1,O.value=!1,l.dispatch("user/getReleases",{projectId:a.params.projectid,page:1,size:10})})).catch((e=>{s.error(e.message),i.value=!1,O.value=!1}))):s.error("请选择制品包"):s.error("请输入版本标题"):s.error("版本信息填写错误，请填写正确的版本信息, 例如：1.0.1")})},{default:z((()=>[_e])),_:1}))])),_:1},8,["open"]),g(W,{open:p.value,actions:"center",onClose:t[8]||(t[8]=e=>p.value=!1),title:"提示信息"},{content:z((()=>[g(T,{title:"您确认要删除此设备吗？"})])),action:z((()=>[g(j,{color:"primary",raised:""},{default:z((()=>[he])),_:1})])),_:1},8,["open"])])):w("",!0)}}});const je={class:"page-title has-text-centered"},xe={class:"menu-toggle has-chevron"},ke=g("span",{class:"rotate"},[g("i",{class:"icon-line-top"}),g("i",{class:"icon-line-center"}),g("i",{class:"icon-line-bottom"})],-1),Ve=g("div",{class:"title-wrap"},[g("h1",{class:"title is-4"},"发版管理")],-1),ze={class:"page-content-inner"},we={class:"breadcrumb-box"},Ne=g("i",{class:"iconify","data-icon":"feather:corner-down-left"},null,-1);var Pe=d({expose:[],setup(e){const a=R(),t=B(),l=A(),s=h(!0);$({title:"版本管理"}),C((()=>{D.value="projects"})),h(!1);const r=y((()=>l.state.user.project)),o=h();return k((()=>{Promise.all([l.dispatch("user/getProject",a.params.projectid),l.dispatch("user/getBuilders",{id:a.params.projectid,page:1,size:10})]).then((()=>{o.value=[{icon:"feather:home",hideLabel:!0,to:{name:"user-projects"}},{label:"项目列表",to:{name:"user-projects"}},{label:r.value.repo_name,to:{name:"user-projects-projectid-files",params:{projectid:a.params.projectid}}},{label:"发版管理"}],s.value=!1}))})),(e,a)=>{const l=i,r=ye,c=L;return m(),v("div",null,[g("div",je,[g("div",{class:"vuero-hamburger nav-trigger push-resize",onClick:a[1]||(a[1]=e=>V(M)("projects"))},[g("span",xe,[g("span",{class:[["projects"===V(D)&&"active"],"icon-box-toggle"]},[ke],2)])]),Ve]),g("div",ze,[g(c,{size:"large",active:s.value},{default:z((()=>[g("div",we,[o.value?(m(),v(l,{key:0,items:o.value,separator:"bullet","with-icons":""},null,8,["items"])):w("",!0),g("div",{onClick:a[2]||(a[2]=()=>V(t).back())},[Ne])]),g(r)])),_:1},8,["active"])])])}}});export default Pe;
