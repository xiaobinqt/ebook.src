var e=Object.defineProperty,a=Object.prototype.hasOwnProperty,t=Object.getOwnPropertySymbols,s=Object.prototype.propertyIsEnumerable,l=(a,t,s)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;import{_ as r}from"./V-Breadcrumb.vue_vue&type=script&setup=true&lang.95222eda.js";import{_ as o}from"./V-Button.vue_vue&type=script&setup=true&lang.7d7c3fd2.js";import{a as c,_ as i}from"./V-Field.vue_vue&type=script&setup=true&lang.50df6a27.js";import{_ as n}from"./V-Tag.vue_vue&type=script&setup=true&lang.bf8fa42e.js";import{t as u}from"./filters.e49d41fb.js";import{d as p,j as d,k as v,S as m,F as f,i as b,l as j,n as h,m as _,E as g,U as y,u as x,B as k,C as w,r as q,v as P,b as V,W as z,A as O,P as T,Z as C,X as S,$ as B,z as N,O as A}from"./vendor.6243191d.js";import{_ as F}from"./V-FlexTable.vue_vue&type=script&setup=true&lang.19fc13e5.js";import{_ as I}from"./V-Modal.vue_vue&type=script&setup=true&lang.13c249d1.js";import{a as L,c as R,d as U,u as E}from"./index.670b29b2.js";import{u as M}from"./useNotyf.8c9a8697.js";import{_ as W}from"./V-Loader.vue_vue&type=script&setup=true&lang.152a1df5.js";import{a as X,t as Z}from"./activeSidebarState.4b53b430.js";import"./moment.08a7f518.js";const $={class:"flex-table-cell","data-th":"Name"},D={class:"flex-table-cell","data-th":"Name"},G={class:"flex-table-cell cell-end","data-th":"Actions"};var H=p({expose:[],props:{rows:{type:Array,required:!0},project:{type:String,required:!0}},setup:e=>(b("removeTag"),(a,t)=>{const s=j("RouterLink"),l=n;return d(!0),v(f,null,m(e.rows,(a=>(d(),v("div",{key:a.id,class:"flex-table-item"},[h("div",$,[h(s,{to:{name:"user-projects-projectid-pulls-number",params:{projectid:e.project,number:a.number}}},{default:_((()=>[g(y(a.title),1)])),_:2},1032,["to"])]),h("div",D,["open"===a.state?(d(),v(l,{key:0,color:"success",label:a.state},null,8,["label"])):(d(),v(l,{key:1,color:"purple",label:a.state},null,8,["label"]))]),h("div",G,y(x(u)(a.created_at)),1)])))),128)})});const J=B();k("data-v-3d2f0219");const K={class:"page-content-inner"},Q={class:"list-view-toolbar"},Y=g(" 合并请求 "),ee={class:"buttons"},ae=g(" 新建合并请求 "),te=h("div",{class:"flex-table-header"},[h("span",null,"标题"),h("span",null,"状态"),h("span",{class:"cell-end"},"时间")],-1),se={class:"form-inner"},le={class:"field is-horizontal"},re=h("div",{class:"field-label is-normal"},[h("label",{class:"label required"},"基础分支")],-1),oe={class:"field-body"},ce={key:0,class:"select"},ie=h("option",{value:""},"请选择基础分支",-1),ne={class:"field is-horizontal"},ue=h("div",{class:"field-label is-normal"},[h("label",{class:"label required"},"标签名称")],-1),pe={class:"field-body"},de=g("确定");w();var ve=p({expose:[],setup(e){const r=M(),n=L();R();const u=U(),p=q(!1);q(""),q(!1),P((()=>{try{n.query.branch}catch(e){}return""})),P((()=>{try{return Number.parseInt(n.query.dir_path)||1}catch(e){}return 1}));const b=P((()=>u.state.user.pulls)),j=q([]),_=P((()=>u.state.user.project));P((()=>u.state.channel.user));const g=V({branch:"master",tag_name:""}),k=()=>{u.dispatch("user/getPullRequests",{id:n.params.projectid,page:1,size:100}).then((()=>{}))};N("removeTag",(e=>{u.dispatch("user/removeTag",{id:n.params.projectid,name:e}).then((()=>{k(),r.success("删除成功！")}))}));const w=q(!1),B=()=>{w.value||(w.value=!0,u.dispatch("user/createTag",((e,r)=>{for(var o in r||(r={}))a.call(r,o)&&l(e,o,r[o]);if(t)for(var o of t(r))s.call(r,o)&&l(e,o,r[o]);return e})({id:n.params.projectid},g)).then((()=>{p.value=!1,w.value=!1,k()})).catch((()=>{r.error("创建标签失败"),w.value=!1})))};return z((()=>{u.dispatch("channel/getProfile"),u.dispatch("user/getBranches",{id:n.params.projectid,simple:!1}).then((e=>{j.value=e.map((e=>"string"==typeof e?e:e.name))})),k()})),(e,a)=>{const t=o,s=c,l=i,r=o,n=H,u=F,k=c,q=i,P=I;return d(),v("div",null,[h("div",K,[h("div",Q,[h(l,{addons:""},{default:J((()=>[h(s,null,{default:J((()=>[h(t,{to:{name:"user-projects-projectid-pulls",params:{projectid:x(_).project_id}},icon:"feather:git-pull-request"},{default:J((()=>[Y])),_:1},8,["to"])])),_:1})])),_:1}),h("div",ee,[h(r,{to:{name:"user-projects-projectid-pulls-new",params:{projectid:x(_).project_id}},color:"primary",elevated:""},{default:J((()=>[ae])),_:1},8,["to"])])]),x(_).project_id?(d(),v(u,{key:0,compact:""},{header:J((()=>[te])),body:J((()=>[h(n,{rows:x(b),project:x(_).project_id},null,8,["rows","project"])])),_:1})):O("",!0),h(P,{open:p.value,size:"large",actions:"center",title:"开始适配",onClose:a[4]||(a[4]=e=>p.value=!1)},{content:J((()=>[h("div",se,[h("div",le,[re,h("div",oe,[h(q,null,{default:J((()=>[h(k,null,{default:J((()=>[j.value?(d(),v("div",ce,[T(h("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>x(g).branch=e)},[ie,(d(!0),v(f,null,m(j.value,((e,a)=>(d(),v("option",{key:"i",value:e},y(e),9,["value"])))),128))],512),[[C,x(g).branch]])])):O("",!0)])),_:1})])),_:1})])]),h("div",ne,[ue,h("div",pe,[h(q,null,{default:J((()=>[h(k,null,{default:J((()=>[T(h("input",{class:"input",type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>x(g).tag_name=e),placeholder:"请输入标签名称"},null,512),[[S,x(g).tag_name]])])),_:1})])),_:1})])])])])),action:J((()=>[h(r,{color:"primary",loading:w.value,onClick:a[3]||(a[3]=e=>B()),raised:""},{default:J((()=>[de])),_:1},8,["loading"])])),_:1},8,["open"])])])}}});ve.__scopeId="data-v-3d2f0219";const me={class:"page-title has-text-centered"},fe={class:"menu-toggle has-chevron"},be=h("span",{class:"rotate"},[h("i",{class:"icon-line-top"}),h("i",{class:"icon-line-center"}),h("i",{class:"icon-line-bottom"})],-1),je=h("div",{class:"title-wrap"},[h("h1",{class:"title is-4"},"Pull Request")],-1),he={class:"page-content-inner"},_e={class:"breadcrumb-box"},ge=h("i",{class:"iconify","data-icon":"feather:corner-down-left"},null,-1);var ye=p({expose:[],setup(e){const a=L(),t=R(),s=U(),l=q(!0);E({title:"合并请求"}),A((()=>{X.value="projects"})),q(!1);const o=P((()=>s.state.user.project));P((()=>s.state.channel.user));const c=q();return z((()=>{Promise.all([s.dispatch("user/getProject",a.params.projectid)]).then((()=>{c.value=[{icon:"feather:home",hideLabel:!0,to:{name:"user-projects"}},{label:"项目列表",to:{name:"user-projects"}},{label:o.value.repo_name,to:{name:"user-projects-projectid-files",params:{projectid:o.value.project_id}}}],l.value=!1}))})),(e,a)=>{const s=r,o=ve,i=W;return d(),v("div",null,[h("div",me,[h("div",{class:"vuero-hamburger nav-trigger push-resize",onClick:a[1]||(a[1]=e=>x(Z)("projects"))},[h("span",fe,[h("span",{class:[["projects"===x(X)&&"active"],"icon-box-toggle"]},[be],2)])]),je]),h("div",he,[h(i,{size:"large",active:l.value},{default:_((()=>[h("div",_e,[c.value?(d(),v(s,{key:0,items:c.value,separator:"bullet","with-icons":""},null,8,["items"])):O("",!0),h("div",{onClick:a[2]||(a[2]=()=>x(t).back())},[ge])]),h(o)])),_:1},8,["active"])])])}}});export default ye;
