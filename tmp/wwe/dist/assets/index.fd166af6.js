import{_ as e}from"./V-Breadcrumb.vue_vue&type=script&setup=true&lang.95222eda.js";import{_ as s}from"./Eventsource.vue_vue&type=script&setup=true&lang.2ffe835f.js";import{a,_ as t}from"./V-Field.vue_vue&type=script&setup=true&lang.50df6a27.js";import{_ as r}from"./V-Button.vue_vue&type=script&setup=true&lang.7d7c3fd2.js";import{_ as o}from"./V-FlexNone.vue_vue&type=script&setup=true&lang.cbed393c.js";import{_ as p}from"./V-FlexTableRowDeploys.d057f8cd.js";import{_ as l}from"./V-FlexTable.vue_vue&type=script&setup=true&lang.19fc13e5.js";import{_ as c}from"./V-FlexPagination.vue_vue&type=script&setup=true&lang.036e60ba.js";import{_ as i}from"./V-PlaceholderSection.vue_vue&type=script&setup=true&lang.67c36c04.js";import{_ as n}from"./V-Modal.vue_vue&type=script&setup=true&lang.13c249d1.js";import{B as u,C as d,d as m,r as v,v as g,a as _,W as f,j,k as y,n as b,u as h,P as x,X as k,A as w,$ as V,E as z,z as C,O as D,m as $,U as F}from"./vendor.6243191d.js";import{a as P,c as B,d as S,u as A}from"./index.670b29b2.js";import{u as N}from"./useNotyf.8c9a8697.js";import{_ as T}from"./V-Loader.vue_vue&type=script&setup=true&lang.152a1df5.js";import{a as E,t as I}from"./activeSidebarState.4b53b430.js";import"./V-Tag.vue_vue&type=script&setup=true&lang.bf8fa42e.js";import"./useDropdown.490deeca.js";import"./index.1b405f09.js";const L=V();u("data-v-0b794d6c");const U={key:0,class:"page-content-inner"},q={class:"list-view-toolbar"},M={class:"buttons"},O=z(" 部署实例 "),R=b("div",{class:"flex-table-header"},[b("span",null,"名称"),b("span",{class:"flex-grow-short"},"部署状态"),b("span",{class:"flex-grow-short"},"运行状态"),b("span",{class:"flex-grow-short"},"终端模型"),b("span",{class:"flex-grow-short"},"终端状态"),b("span",null,"制品包"),b("span",{class:"time"},"时间"),b("span",{class:"cell-end"},"操作")],-1),W=z("确认");d();var X=m({expose:[],setup(e){const u=N(),d=P();B();const m=S();v(!1),v();const V=v(""),z=v(!1),D=g((()=>{try{return Number.parseInt(d.query.page)||1}catch(e){}return 1})),$=g((()=>m.state.user.deploys)),F=g((()=>m.state.user.project)),A=v(null),T={deploy_app:"部署",start_app:"启动",stop_app:"停止"},E=e=>{"successed"===e.status&&u.success(`实例 ${e.instance_name} ${T[e.topic]}成功！`),"failed"===e.status&&u.error(`实例 ${e.instance_name} ${T[e.topic]}失败，${e.message}`),m.dispatch("user/getDeploys",{id:d.params.projectid,page:D.value,size:10})};_([V,D],((e,s)=>{e[0]===s[0]&&e[1]===s[1]||m.dispatch("user/getDeploys",{id:d.params.projectid,page:D.value,size:10,search:e[0]})}));const I=e=>{console.log("row.instance_id",A),m.dispatch("user/removeApp",A.value.instance_id).then((()=>{u.success("删除成功！"),z.value=!1,m.dispatch("user/getDeploys",{id:d.params.projectid,page:1,size:10})}))};return C("removeApp",(e=>{z.value=!0,A.value=e})),f((()=>{m.dispatch("user/getDeploys",{id:d.params.projectid,page:D.value,size:10})})),(e,u)=>{const m=s,v=a,g=t,_=r,f=o,C=p,P=l,B=c,S=i,A=r,N=n;return j(),y("div",null,[b(m,{topic:"deploy_app|start_app|stop_app",onmessage:E}),h(F).project_id?(j(),y("div",U,[b("div",q,[b(g,null,{default:L((()=>[b(v,{icon:"feather:search"},{default:L((()=>[x(b("input",{"onUpdate:modelValue":u[1]||(u[1]=e=>V.value=e),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[k,V.value]])])),_:1})])),_:1}),b("div",M,[b(_,{to:{name:"user-projects-projectid-deploys-new",params:{projectid:h(d).params.projectid}},color:"primary",elevated:""},{default:L((()=>[O])),_:1},8,["to"])])]),h($)&&0===h($).data.length?(j(),y(f,{key:0,title:"没有数据",subtitle:"当前没有要显示的数据"})):(j(),y(P,{key:1,compact:""},{header:L((()=>[R])),body:L((()=>[b(C,{rows:h($).data,project:h(F).project_id},null,8,["rows","project"])])),_:1})),h($).page_info.count?(j(),y(B,{key:2,"item-per-page":h($).page_info.size,"total-items":h($).page_info.count,"current-page":h(D),"max-links-displayed":5},null,8,["item-per-page","total-items","current-page"])):w("",!0)])):w("",!0),b(N,{open:z.value,actions:"center",onClose:u[2]||(u[2]=e=>z.value=!1),title:"提示信息"},{content:L((()=>[b(S,{title:"您确认要删除此应用吗？"})])),action:L((()=>[b(A,{color:"primary",onClick:I,raised:""},{default:L((()=>[W])),_:1})])),_:1},8,["open"])])}}});X.__scopeId="data-v-0b794d6c";const G={class:"page-title has-text-centered"},H={class:"menu-toggle has-chevron"},J=b("span",{class:"rotate"},[b("i",{class:"icon-line-top"}),b("i",{class:"icon-line-center"}),b("i",{class:"icon-line-bottom"})],-1),K=b("div",{class:"title-wrap"},[b("h1",{class:"title is-4"},"持续部署")],-1),Q={class:"page-content-inner"},Y={class:"breadcrumb-box"},Z=b("i",{class:"iconify","data-icon":"feather:corner-down-left"},null,-1),ee={key:0,class:"public-key-box"},se={class:"pre-box"};var ae=m({expose:[],setup(s){const a=P(),t=B(),r=S(),o=v(!0);A({title:"持续部署"}),D((()=>{E.value="projects"}));const p=v(!1),l=g((()=>r.state.user.project)),c=v();return f((()=>{Promise.all([r.dispatch("user/getProject",a.params.projectid),r.dispatch("user/getBuilders",{id:a.params.projectid,page:1,size:10})]).then((()=>{c.value=[{icon:"feather:home",hideLabel:!0,to:{name:"user-projects"}},{label:"项目列表",to:{name:"user-projects"}},{label:l.value.repo_name,to:{name:"user-projects-projectid-files",params:{projectid:a.params.projectid}}},{label:"持续部署",to:{name:"user-projects-projectid-deploys",params:{projectid:a.params.projectid}}}],o.value=!1}))})),D((()=>{})),(s,a)=>{const r=e,i=X,u=T,d=n;return j(),y("div",null,[b("div",G,[b("div",{class:"vuero-hamburger nav-trigger push-resize",onClick:a[1]||(a[1]=e=>h(I)("projects"))},[b("span",H,[b("span",{class:[["projects"===h(E)&&"active"],"icon-box-toggle"]},[J],2)])]),K]),b("div",Q,[b(u,{size:"large",active:o.value},{default:$((()=>[b("div",Y,[c.value?(j(),y(r,{key:0,items:c.value,separator:"bullet","with-icons":""},null,8,["items"])):w("",!0),b("div",{onClick:a[2]||(a[2]=()=>h(t).back())},[Z])]),h(l)?(j(),y(i,{key:0})):w("",!0)])),_:1},8,["active"])]),b(d,{open:p.value,size:"large",actions:"center",title:"查看公钥",onClose:a[3]||(a[3]=e=>p.value=!1)},{content:$((()=>[h(l).deploy_key?(j(),y("div",ee,[b("div",se,[b("pre",null,F(h(l).deploy_key.public_key),1)])])):w("",!0)])),action:$((()=>[])),_:1},8,["open"])])}}});export default ae;
