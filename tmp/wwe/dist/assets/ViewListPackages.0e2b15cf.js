import{a as e,_ as a}from"./V-Field.vue_vue&type=script&setup=true&lang.50df6a27.js";import{_ as l}from"./V-Button.vue_vue&type=script&setup=true&lang.7d7c3fd2.js";import{_ as t}from"./V-FlexNone.vue_vue&type=script&setup=true&lang.cbed393c.js";import{_ as s}from"./V-Desc.vue_vue&type=style&index=0&media=screen&lang.a15b66b4.js";import{t as i}from"./filters.e49d41fb.js";import{B as n,C as o,d as c,r as u,j as d,k as r,S as p,F as v,i as m,l as f,Q as g,n as k,P as h,E as x,U as _,u as y,A as b,$ as O,v as w,b as C,a as j,W as V,X as A,Z as z,z as P}from"./vendor.6243191d.js";import{_ as N}from"./V-FlexTable.vue_vue&type=script&setup=true&lang.19fc13e5.js";import{_ as q}from"./V-FlexPagination.vue_vue&type=script&setup=true&lang.036e60ba.js";import{_ as F}from"./V-Message.vue_vue&type=script&setup=true&lang.177426e4.js";import{_ as E}from"./V-Modal.vue_vue&type=script&setup=true&lang.13c249d1.js";import{_ as U}from"./V-PlaceholderSection.vue_vue&type=script&setup=true&lang.67c36c04.js";import{_ as I}from"./V-Checkbox.vue_vue&type=script&setup=true&lang.27382a85.js";import{g as R,a as S,c as B,d as M}from"./index.670b29b2.js";import{u as $}from"./useNotyf.8c9a8697.js";const D=O();n("data-v-4019c38c");const L={class:"flex-table-cell","data-th":"Name"},T={id:"type"},X={class:"flex-table-cell","data-th":"Name"},H={class:"flex-table-cell flex-version","data-th":"Name"},Q={class:"flex-table-cell","data-th":"Name"},W={class:"flex-table-cell cell-end","data-th":"Actions"},Z={class:"buttons"},G=k("span",{class:"icon is-small"},[k("i",{class:"iconify","data-icon":"feather:user-check"})],-1),J=k("span",{class:"icon is-small"},[k("i",{class:"iconify","data-icon":"feather:download-cloud"})],-1),K=k("span",{class:"icon is-small"},[k("i",{class:"iconify","data-icon":"feather:trash-2"})],-1),Y=k("span",{class:"icon is-small"},[k("i",{class:"iconify","data-icon":"feather:copy"})],-1);o();var ee=c({expose:[],props:{rows:{type:Array,required:!0},isAdmin:{type:Boolean,required:!0}},setup(e){const a=m("removePackage"),l=m("publicPackage"),t=m("clonePackage"),n=u(localStorage.getItem("login_attr")),o=e=>{console.log("row.url",e.download_url);const a=new XMLHttpRequest;a.open("get",e.download_url,!0),a.responseType="blob",a.setRequestHeader("X-Token",localStorage.getItem("token")),a.onload=function(){if(console.log(a),200===this.status){const a=this.response,l=new FileReader;l.readAsDataURL(a),l.onload=function(a){const l=document.createElement("a");l.download=e.download_url.split("/").pop(),l.href=a.target.result;const t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),l.dispatchEvent(t)}}},a.send()};function c(e){return e.length>10&&(e=e.substr(0,10)+"..."),e}return(u,m)=>{const O=f("RouterLink"),w=s,C=g("tooltip");return d(!0),r(v,null,p(e.rows,(s=>(d(),r("div",{key:s.id,class:"flex-table-item"},[k("div",L,[h(k("div",T,[k("img",{class:"icon-img",src:"private"===s.type?"/icons/personal.png":"/icons/public.png",alt:""},null,8,["src"])],512),[[C,"private"===s.type?"私有":"公有",void 0,{top:!0,right:!0,rounded:!0}]]),"2"===n.value?h((d(),r(O,{key:0,class:"packages_name",to:{name:"admin-packages-packagesid",params:{packagesid:s.id},query:{files:s.download_url}}},{default:D((()=>[x(_(s.text?c(s.text):c(s.description)),1)])),_:2},1032,["to"])),[[C,s.text?s.text:s.description,void 0,{top:!0,right:!0,rounded:!0}]]):h((d(),r(O,{key:1,class:"packages_name",to:{name:"user-packages-packagesid",params:{packagesid:s.id},query:{files:s.download_url}}},{default:D((()=>[x(_(s.text?c(s.text):c(s.description)),1)])),_:2},1032,["to"])),[[C,s.text?s.text:s.description,void 0,{top:!0,right:!0,rounded:!0}]])]),k("div",X,[h(k(w,{content:s.id},null,8,["content"]),[[C,s.id,void 0,{top:!0,right:!0,rounded:!0}]])]),k("div",H,_(s.version),1),h(k("div",{class:"flex-table-cell flex-grow-short","data-th":"Name"},_(c(s.description)),513),[[C,s.description?s.description:"无描述信息",void 0,{top:!0,right:!0,wrap:!0,rounded:!0}]]),h(k("div",{class:"flex-table-cell","data-th":"Name"},_(c(s.author)),513),[[C,s.author,void 0,{top:!0,right:!0,rounded:!0}]]),k("div",Q,_(y(i)(s.updated_at)),1),k("div",W,[k("div",Z,[e.isAdmin&&"private"===s.type?h((d(),r("button",{key:0,onClick:e=>y(l)(s),class:"button is-dark-outlined is-circle"},[G],8,["onClick"])),[[C,"设为公开",void 0,{top:!0,right:!0,rounded:!0}]]):b("",!0),h(k("button",{onClick:e=>o(s),class:"button is-dark-outlined is-circle"},[J],8,["onClick"]),[[C,"下载",void 0,{top:!0,right:!0,rounded:!0}]]),e.isAdmin&&"sg"===s.type||!e.isAdmin?h((d(),r("button",{key:1,onClick:e=>y(a)(s),disabled:e.isAdmin&&"sg"!==s.type||!e.isAdmin&&"private"!==s.type,class:"button is-dark-outlined is-circle"},[K],8,["onClick","disabled"])),[[C,"删除",void 0,{top:!0,right:!0,rounded:!0}]]):b("",!0),e.isAdmin?b("",!0):h((d(),r("button",{key:2,disabled:!e.isAdmin&&"private"===s.type,onClick:e=>(e=>{t(e)})(s),class:"button is-dark-outlined is-circle"},[Y],8,["disabled","onClick"])),[[C,"克隆",void 0,{top:!0,right:!0,rounded:!0}]])])])])))),128)}}});ee.__scopeId="data-v-4019c38c";const ae=O();n("data-v-3d0604d2");const le={key:0},te=k("div",{class:"desc-container"}," 节点商店将已上传的npm节点包统一管理，支持多租户权限系统。商店中包含全员可见的公开节点和属于用户个人的非公开私有节点 ",-1),se={class:"list-view-toolbar"},ie={class:"select"},ne=k("option",{value:""},"全部",-1),oe=k("option",{value:"private"},"私有",-1),ce=k("option",{value:"sg"},"公有",-1),ue={class:"buttons"},de=x("上传组件节点"),re={class:"page-content-inner"},pe=k("div",{class:"flex-table-header"},[k("span",null,"节点名称"),k("span",null,"节点包名"),k("span",{class:"flex-version"},"节点版本"),k("span",{class:"flex-grow-short"},"节点描述"),k("span",null,"作者"),k("span",null,"上传时间"),k("span",{class:"cell-end",id:"button"},"操作")],-1),ve={class:"file is-boxed"},me={class:"file-label"},fe={class:"file-cta"},ge=k("span",{class:"file-icon"},[k("i",{class:"fas fa-cloud-upload-alt"})],-1),ke={class:"file-label"},he=x("确认"),xe={style:{"text-align":"center"}},_e=x("确认"),ye=k("span",{class:"clone-title"},"项目名称",-1),be=k("i",{class:"fas fa-spinner fa-pulse"},null,-1),Oe=x("确认");o();var we=c({expose:[],props:{audit:{type:Boolean,default:!1}},setup(s){const i=S(),n=B(),o=M(),c=$(),p=u(!1),v=u(!1),m=u(!1),f=u(""),g=u(""),O=u(),D=u(""),L=u(""),T=u([]),X=u(!1),H=w((()=>{try{return Number.parseInt(i.query.page)||1}catch(e){}return 1})),Q=w((()=>o.state.channel.packages)),W=w((()=>o.state.channel.user));P("clonePackage",(e=>{W.value.edge_id?(m.value=!0,O.value=e,D.value=`${e.id.substring(4)}-clone-${W.value.user_name}`):c.error("请确认开发机是否正常")}));const Z=()=>{if(X.value)return!1;""!==D.value?/^[A-z0-9][\w\-]+$/.test(D.value)?(X.value=!0,o.dispatch("user/createProject",{repo_name:D.value,desc:"",level:"2",model_id:"",data_set:[],fork_npm:"1",fork_npm_url:O.value.download_url}).then((e=>{m.value=!1,X.value=!1,n.push("projects"),console.log(e)})).catch((e=>{X.value=!1,c.error(e.message)}))):c.error("项目名称只能包含字母数字、减号和下划线"):c.error("项目名称不能为空")},G=()=>{o.dispatch("channel/removePackage",{package:O.value.id,version:O.value.version,all_version:T.value.length>0?1:void 0}).then((async()=>{c.success("删除成功！"),v.value=!1;let e,a=await R({page:H.value,size:10});""===f.value&&""===g.value?e=a.modules:""!==f.value&&""===g.value?e=a.modules.filter((e=>-1!==e.id.indexOf(f.value)||-1!==e.text.indexOf(f.value)||-1!==e.description.indexOf(f.value))):""===f.value&&""!==g.value?e=a.modules.filter((e=>e.type===g.value)):""!==f.value&&""!==g.value&&(e=a.modules.filter((e=>(-1!==e.id.indexOf(f.value)||-1!==e.text.indexOf(f.value)||-1!==e.description.indexOf(f.value))&&e.type===g.value))),o.commit("channel/packages",{data:e.slice(10*(H.value-1),10*H.value),name:a.name,page_info:{count:e.length,size:10,page:H.value}}),we=a}))};P("removePackage",(e=>{O.value=e,v.value=!0}));P("publicPackage",(e=>{o.dispatch("channel/publicPackage",{package:e.id,version:e.version}).then((async()=>{n.push("packages"),c.success("已设为公开！");let e=await R({page:1,size:10});o.commit("channel/packages",{data:e.modules.slice(10*(H.value-1),10*H.value),name:e.name,page_info:{count:e.modules.length,size:10,page:1}}),we=e})).catch((e=>{c.error(e.msg||e.message||e)}))}));const J=C({package:""}),K=e=>{const a=new FormData;a.append("package",J.package),""!==J.package?o.dispatch("channel/createPackage",a).then((async()=>{n.push("packages"),c.success("上传成功！"),p.value=!1,J.package="";let e=await R({page:1,size:10});o.commit("channel/packages",{data:e.modules.slice(10*(H.value-1),10*H.value),name:e.name,page_info:{count:e.modules.length,size:10,page:1}}),we=e})).catch((e=>{L.value=e.message||e})):p.value=!1},Y=function(e){const a=e.target.files[0];J.package=a};let we=C({});return j([f,g,H],((e,a)=>{let l,t=we.modules;if(e[0]!==a[0])n.push("packages"),g.value?(l=we.modules.filter((e=>e.type===g.value)),t=l.filter((a=>-1!==a.id.indexOf(e[0])||-1!==a.text.indexOf(e[0])||-1!==a.description.indexOf(e[0])))):t=we.modules.filter((a=>-1!==a.id.indexOf(e[0])||-1!==a.text.indexOf(e[0])||-1!==a.description.indexOf(e[0])));else if(e[1]!==a[1])n.push("packages"),""==e[1]?t=f.value?we.modules.filter((e=>-1!==e.id.indexOf(f.value)||-1!==e.text.indexOf(f.value)||-1!==e.description.indexOf(f.value))):we.modules:f.value?(l=we.modules.filter((a=>a.type===e[1])),t=l.filter((e=>-1!==e.id.indexOf(f.value)||-1!==e.text.indexOf(f.value)||-1!==e.description.indexOf(f.value)))):t=we.modules.filter((a=>a.type===e[1]));else if(e[2]!==a[2])return""==e[1]?t=f.value?we.modules.filter((e=>-1!==e.id.indexOf(f.value)||-1!==e.text.indexOf(f.value)||-1!==e.description.indexOf(f.value))):we.modules:(t=we.modules.filter((a=>a.type===e[1])),f.value&&(l=we.modules.filter((a=>a.type===e[1])),t=l.filter((e=>-1!==e.id.indexOf(f.value)||-1!==e.text.indexOf(f.value)||-1!==e.description.indexOf(f.value))))),f.value&&(t=we.modules.filter((e=>-1!==e.id.indexOf(f.value)||-1!==e.text.indexOf(f.value)||-1!==e.description.indexOf(f.value))),g.value&&(l=t.filter((e=>e.type===g.value)),t=l.filter((a=>-1!==a.id.indexOf(e[0])||-1!==a.text.indexOf(e[0])||-1!==a.description.indexOf(e[0]))))),void o.commit("channel/packages",{data:t.slice(10*(H.value-1),10*H.value),name:we.name,page_info:{count:t.length,size:10,page:H.value}});o.commit("channel/packages",{data:t.slice(10*(H.value-1),10*H.value),name:we.name,page_info:{count:t.length,size:10,page:1}})})),V((async()=>{let e=await R({page:H.value,size:10});o.commit("channel/packages",{data:e.modules.slice(10*(H.value-1),10*H.value),name:e.name,page_info:{count:e.modules.length,size:10,page:H.value}}),we=e})),(s,i)=>{const n=e,o=a,c=l,u=t,O=ee,w=N,C=q,j=e,V=a,P=F,R=l,S=E,B=U,M=I;return y(Q).name?(d(),r("div",le,[te,k("div",se,[k(o,null,{default:ae((()=>[k(n,{icon:"feather:search"},{default:ae((()=>[h(k("input",{"onUpdate:modelValue":i[1]||(i[1]=e=>f.value=e),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[A,f.value]])])),_:1})])),_:1}),k(o,null,{default:ae((()=>[k(n,null,{default:ae((()=>[k("div",ie,[h(k("select",{"onUpdate:modelValue":i[2]||(i[2]=e=>g.value=e)},[ne,oe,ce],512),[[z,g.value]])])])),_:1})])),_:1}),b("",!0),k("div",ue,[k(c,{color:"success",onClick:i[3]||(i[3]=e=>p.value=!0)},{default:ae((()=>[de])),_:1})])]),k("div",re,[y(Q)&&0===y(Q).data.length?(d(),r(u,{key:0,title:"没有数据",subtitle:"当前没有要显示的数据"})):(d(),r(w,{key:1,compact:""},{header:ae((()=>[pe])),body:ae((()=>[k(O,{isAdmin:2===y(W).login_attr,rows:y(Q).data},null,8,["isAdmin","rows"])])),_:1})),y(Q).page_info.count?(d(),r(C,{key:2,"item-per-page":y(Q).page_info.size,"total-items":y(Q).page_info.count,"current-page":y(H),"max-links-displayed":5},null,8,["item-per-page","total-items","current-page"])):b("",!0)]),k(S,{open:p.value,actions:"center",onClose:i[4]||(i[4]=e=>{p.value=!1,L.value=""}),title:"上传组件节点"},{content:ae((()=>[k(V,{grouped:""},{default:ae((()=>[k(j,null,{default:ae((()=>[k("div",ve,[k("label",me,[k("input",{onChange:Y,class:"file-input",type:"file",accept:".tar",name:"package"},null,32),k("span",fe,[ge,k("span",ke,_(y(J).package?y(J).package.name:"请选择文件"),1)])])])])),_:1})])),_:1}),k("div",null,[L.value?(d(),r(P,{key:0,color:"danger"},{default:ae((()=>[x(_(L.value),1)])),_:1})):b("",!0)])])),action:ae((()=>[k(R,{color:"primary",onClick:K,raised:""},{default:ae((()=>[he])),_:1})])),_:1},8,["open"]),k(S,{open:v.value,actions:"center",onClose:i[6]||(i[6]=e=>v.value=!1),title:"提示信息"},{content:ae((()=>[k(B,{title:"您确认要删除此组件吗？"}),k("div",xe,[k(M,{modelValue:T.value,"onUpdate:modelValue":i[5]||(i[5]=e=>T.value=e),value:"1",label:"同时删除当前组件的所有版本",color:"info"},null,8,["modelValue"])])])),action:ae((()=>[k(R,{color:"primary",onClick:G,raised:""},{default:ae((()=>[_e])),_:1})])),_:1},8,["open"]),k(S,{open:m.value,actions:"center",onClose:i[8]||(i[8]=e=>X.value?m.value=!0:m.value=!1),title:"节点克隆"},{content:ae((()=>[k("div",null,[ye,h(k("input",{class:"input clone-input",type:"text","onUpdate:modelValue":i[7]||(i[7]=e=>D.value=e)},null,512),[[A,D.value]])])])),action:ae((()=>[X.value?(d(),r(R,{key:0,color:"primary",disabled:"",onClick:Z,raised:""},{default:ae((()=>[be])),_:1})):(d(),r(R,{key:1,color:"primary",onClick:Z,raised:""},{default:ae((()=>[Oe])),_:1}))])),_:1},8,["open"])])):b("",!0)}}});we.__scopeId="data-v-3d0604d2";export{we as _};
