var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,s=Object.getOwnPropertySymbols,a=Object.prototype.propertyIsEnumerable,l=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,o=(e,o)=>{for(var i in o||(o={}))t.call(o,i)&&l(e,i,o[i]);if(s)for(var i of s(o))a.call(o,i)&&l(e,i,o[i]);return e};import{_ as i}from"./V-Breadcrumb.vue_vue&type=script&setup=true&lang.95222eda.js";import{d as r,W as n,f as d,v as c,j as p,k as u,u as m,n as g,A as v,U as h,D as f,l as _,r as y,F as b,S as x,B as k,C as w,a as j,$ as S,E as O,z as B,O as P,P as V,m as $,Q as C}from"./vendor.6243191d.js";import{_ as T}from"./V-IconButton.vue_vue&type=script&setup=true&lang.88eaeff3.js";import{t as I,u as M}from"./useNotyf.8c9a8697.js";import{f as z,a as E}from"./filters.e49d41fb.js";import{d as q,a as Z,c as F,u as L}from"./index.670b29b2.js";import{_ as U}from"./Eventsource.vue_vue&type=script&setup=true&lang.2ffe835f.js";import{_ as A}from"./V-FlexNone.vue_vue&type=script&setup=true&lang.cbed393c.js";import{_ as N}from"./V-FlexTableRowDeploys.d057f8cd.js";import{_ as D}from"./V-FlexTable.vue_vue&type=script&setup=true&lang.19fc13e5.js";import{_ as H}from"./V-PlaceholderSection.vue_vue&type=script&setup=true&lang.67c36c04.js";import{_ as J}from"./V-Button.vue_vue&type=script&setup=true&lang.7d7c3fd2.js";import{_ as Q}from"./V-Modal.vue_vue&type=script&setup=true&lang.13c249d1.js";import{_ as R}from"./V-Tabs.vue_vue&type=script&setup=true&lang.33403b64.js";import{b as W,a as G,t as K}from"./activePanelState.21033cba.js";import{_ as X}from"./V-Loader.vue_vue&type=script&setup=true&lang.152a1df5.js";import{a as Y,t as ee}from"./activeSidebarState.4b53b430.js";import"./moment.08a7f518.js";import"./V-Tag.vue_vue&type=script&setup=true&lang.bf8fa42e.js";import"./useDropdown.490deeca.js";import"./index.1b405f09.js";import"./V-Icon.vue_vue&type=script&setup=true&lang.7e1a2cfa.js";var te=r({expose:[],props:{onmessage:{type:Function,default:!1},topic:{type:String,default:!1}},setup(e){const{onmessage:t,topic:s}=e;let a;return n((()=>{a=new EventSource(`/api/edges/${s}/stats?token=${localStorage.getItem("token")}`),a.addEventListener("stats",(function(e){if(e.data)try{const s=JSON.parse(e.data);t(s)}catch(s){}}))})),d((()=>{a.close()})),(e,t)=>null}});const se={key:1,class:"snack-media"},ae={class:"snack-text"},le={class:"snack-action"};var oe=r({expose:[],props:{title:{type:String,required:!0},icon:{type:String,default:void 0},image:{type:String,default:void 0},placeholder:{type:String,default:"https://via.placeholder.com/50x50"},color:{type:String,default:void 0,validator:e=>-1!==[void 0,"primary","success","info","warning","danger"].indexOf(e)||(console.warn(`V-Snack: invalid "${e}" color. Should be primary, success, info, warning, danger or undefined`),!1)},size:{type:String,default:void 0,validator:e=>-1!==[void 0,"small"].indexOf(e)||(console.warn(`V-Snack: invalid "${e}" size. Should be small or undefined`),!1)},solid:{type:Boolean,default:!1},white:{type:Boolean,default:!1}},setup(e){const t=e,s=c((()=>t.icon&&-1!==t.icon.indexOf(":")));return(t,a)=>(p(),u("div",{class:["snack",[e.white&&"is-white",e.size&&`is-${e.size}`]]},[e.icon?(p(),u("div",{key:0,class:["snack-media is-icon",[e.color&&`is-${e.color}`,e.solid&&"is-solid"]]},[m(s)?(p(),u("i",{key:0,class:"iconify snack-icon","data-icon":e.icon},null,8,["data-icon"])):(p(),u("i",{key:1,class:["snack-icon",e.icon]},null,2))],2)):e.image?(p(),u("div",se,[g("img",{class:"avatar",src:e.image,alt:"",onErrorOnce:a[1]||(a[1]=t=>t.target.src=e.placeholder)},null,40,["src"])])):v("",!0),g("span",ae,h(e.title),1),g("span",le,[f(t.$slots,"default")])],2))}});const ie={key:0,class:"apex-dashboard"},re={class:"columns is-multiline"},ne={class:"column is-2 flex-centered"},de=g("div",{class:"desc"},"终端状态",-1),ce={class:"column is-2"},pe={class:"column is-2"},ue={class:"column is-6"},me={class:"overvie-stats"},ge={class:"small"},ve=g("dd",null,"硬盘IOPS ( 读 )",-1),he=g("dd",null,"硬盘IOPS ( 写 )",-1),fe={class:"small"},_e=g("dd",null,"硬盘吞吐量 ( 读 )",-1),ye=g("dd",null,"硬盘吞吐量 ( 写 )",-1),be={class:"small"},xe=g("dd",null,"网络带宽 ( 进 )",-1),ke=g("dd",null,"网络带宽 ( 出 )",-1);var we=r({expose:[],props:{edge:{type:Object,required:!1},stats:{type:Object,required:!1}},setup(e){const t=e,s={series:[1],title:{text:""},chart:{height:165,type:"radialBar",toolbar:{show:!1}},colors:[I.blue,I.info],plotOptions:{radialBar:{hollow:{size:"70%"}}},labels:["CPU"]},a={series:[1],title:{text:""},chart:{height:165,type:"radialBar",toolbar:{show:!1}},colors:[I.blue,I.info],plotOptions:{radialBar:{hollow:{size:"70%"}}},labels:["Mem"]};return console.log("props",t),(e,l)=>{const o=oe,i=_("apexchart");return t.stats.cpu?(p(),u("div",ie,[g("div",re,[g("div",ne,[g("div",null,[1===t.edge.health?(p(),u(o,{key:0,title:"健康",color:"success",solid:"",icon:"feather:check"})):(p(),u(o,{key:1,title:"异常",color:"danger",solid:"",icon:"feather:check"})),de])]),g("div",ce,[g(i,{id:"apex-chart-19",height:s.chart.height,type:s.chart.type,series:[Math.round(100*(100-t.stats.cpu.idle))/100],options:s},null,8,["height","type","series"])]),g("div",pe,[g(i,{id:"apex-chart-19",height:a.chart.height,type:a.chart.type,series:[Math.round(t.stats.mem.used/t.stats.mem.total*1e4)/100],options:a},null,8,["height","type","series"])]),g("div",ue,[g("div",me,[g("dl",ge,[g("dt",null,h(m(z)(t.stats.disk[0].rds)),1),ve,g("dt",null,h(m(z)(t.stats.disk[0].wrs)),1),he]),g("dl",fe,[g("dt",null,h(m(z)(t.stats.disk[0].rops)),1),_e,g("dt",null,h(m(z)(t.stats.disk[0].wops)),1),ye]),g("dl",be,[g("dt",null,h(m(z)(t.stats.net[0].ibs)),1),xe,g("dt",null,h(m(z)(t.stats.net[0].obs)),1),ke])])])])])):v("",!0)}}});const je={class:"apex-dashboard"},Se={class:"columns is-multiline"},Oe={class:"column is-6"},Be={class:"s-card"};var Pe=r({expose:[],props:{edge:{type:Object,required:!1},stats:{type:Object,required:!1}},setup(e){const t=e,s={series:[{name:"Completed",data:[31,40,28,51,42,109,100]},{name:"Pending",data:[11,32,45,32,34,52,41]}],chart:{height:280,type:"area",toolbar:{show:!1}},colors:[I.green,I.info,I.purple],title:{text:"Multiple",align:"left"},legend:{position:"top"},dataLabels:{enabled:!1},stroke:{width:[1,1,1],curve:"straight"},xaxis:{type:"datetime",categories:["2018-09-19T00:00:00.000Z","2018-09-19T01:30:00.000Z","2018-09-19T02:30:00.000Z","2018-09-19T03:30:00.000Z","2018-09-19T04:30:00.000Z","2018-09-19T05:30:00.000Z","2018-09-19T06:30:00.000Z"]},tooltip:{x:{format:"dd/MM/yy HH:mm"}}},a="edge",l=q();c((()=>l.state.user.deploy));const i=y(3600),r=y([]),d=e=>{l.dispatch("user/getMonitors",{id:t.edge.edge_id,type:a,series:e,since:i.value,join:!0,step:60}).then((e=>{const t=[],a={};e.forEach((e=>{a[e.name]=e.points}));const l=o(o({},s),{series:[{name:"CPU使用率",data:a.flexcloud_edge_cpu_total.map((e=>e[1]))}],xaxis:{type:"datetime",categories:a.flexcloud_edge_cpu_total.map((e=>e[0]))},yaxis:{labels:{show:!0,formatter:e=>`${e}%`}},title:{text:"CPU",align:"left"}}),i=o(o({},s),{series:[{name:"内存总量",data:a.flexcloud_edge_memory_total.map((e=>e[1]))},{name:"内存使用",data:a.flexcloud_edge_memory_usage.map((e=>e[1]))}],xaxis:{type:"datetime",categories:a.flexcloud_edge_memory_usage.map((e=>e[0]))},yaxis:{labels:{show:!0,formatter:e=>E(e,"B")}},title:{text:"内存",align:"left"}}),n=o(o({},s),{series:[{name:"读",data:a.flexcloud_edge_blkio_read_ps.map((e=>e[1]))},{name:"写",data:a.flexcloud_edge_blkio_write_ps.map((e=>e[1]))}],xaxis:{type:"datetime",categories:a.flexcloud_edge_blkio_read_ps.map((e=>e[0]))},yaxis:{labels:{show:!0,formatter:e=>E(e,"B")}},title:{text:"硬盘IOPS",align:"left"}}),d=o(o({},s),{series:[{name:"读",data:a.flexcloud_edge_blkio_read_Bps.map((e=>e[1]))},{name:"写",data:a.flexcloud_edge_blkio_write_Bps.map((e=>e[1]))}],xaxis:{type:"datetime",categories:a.flexcloud_edge_blkio_write_Bps.map((e=>e[0]))},yaxis:{labels:{show:!0,formatter:e=>E(e,"B")}},title:{text:"硬盘吞吐量",align:"left"}}),c=o(o({},s),{series:[{name:"进",data:a.flexcloud_edge_network_tx_bps.map((e=>e[1]))},{name:"出",data:a.flexcloud_edge_network_rx_bps.map((e=>e[1]))}],xaxis:{type:"datetime",categories:a.flexcloud_edge_network_tx_bps.map((e=>e[0]))},yaxis:{labels:{show:!0,formatter:e=>E(e,"B")}},title:{text:"网络带宽",align:"left"}}),p=o(o({},s),{series:[{name:"rtt",data:a.flexcloud_edge_edge_rtt.map((e=>e[1]))}],xaxis:{type:"datetime",categories:a.flexcloud_edge_edge_rtt.map((e=>e[0]))},yaxis:{labels:{show:!0,formatter:e=>((e,t)=>Math.round(e/t*100)/100)(e,1)+"ms"}},title:{text:"心跳时延",align:"left"}});t.push(l),t.push(i),t.push(n),t.push(d),t.push(c),t.push(p),r.value=t}))};return n((()=>{l.dispatch("user/getMonitorsLatest",{id:t.edge.edge_id,type:a,join:!0,series:""}).then((e=>{d(e.map((e=>e.name.replace("flexcloud_edge_",""))))}))})),(e,t)=>{const s=_("apexchart");return p(),u("div",je,[g("div",Se,[(p(!0),u(b,null,x(r.value,(e=>(p(),u("div",Oe,[g("div",Be,[g(s,{id:"apex-chart-1",height:e.chart.height,type:e.chart.type,series:e.series,options:e},null,8,["height","type","series","options"])])])))),256))])])}}});const Ve=S();k("data-v-058e8767");const $e={class:"page-content-inner"},Ce=g("div",{class:"flex-table-header"},[g("span",null,"名称"),g("span",{class:"flex-grow-short"},"部署状态"),g("span",{class:"flex-grow-short"},"运行状态"),g("span",{class:"flex-grow-short"},"端设备模型"),g("span",null,"所属人"),g("span",{class:"time"},"时间"),g("span",{class:"cell-end"},"操作")],-1),Te=O("确认");w();var Ie=r({expose:[],props:{deploys:{type:Object,required:!0}},setup(e){const{deploys:t}=e,s=M(),a=Z();F();const l=q();y(!1),y();const o=y(""),i=y(!1),r=c((()=>{try{return Number.parseInt(a.query.page)||1}catch(e){}return 1})),n=y(null),d={deploy_app:"部署",start_app:"启动",stop_app:"停止"},m=e=>{"successed"===e.status&&s.success(`实例 ${e.instance_name} ${d[e.topic]}成功！`),"failed"===e.status&&s.error(`实例 ${e.instance_name} ${d[e.topic]}失败，${e.message}`),l.dispatch("channel/getEdge",t[0].edge_id)};j([o,r],((e,t)=>{e[0]!==t[0]||(e[1],t[1])}));const v=e=>{console.log("row.instance_id",n),l.dispatch("user/removeApp",n.value.instance_id).then((()=>{s.success("删除成功！"),i.value=!1}))};return B("removeApp",(e=>{i.value=!0,n.value=e})),console.log("deploys",t),(e,s)=>{const a=U,l=A,o=N,r=D,n=H,d=J,c=Q;return p(),u("div",null,[g(a,{topic:"deploy_app|start_app|stop_app",onmessage:m}),g("div",$e,[0===t.length?(p(),u(l,{key:0,title:"没有数据",subtitle:"当前没有要显示的数据"})):(p(),u(r,{key:1,compact:""},{header:Ve((()=>[Ce])),body:Ve((()=>[g(o,{rows:t,edge:t[0].edge_id},null,8,["edge"])])),_:1}))]),g(c,{open:i.value,actions:"center",onClose:s[1]||(s[1]=e=>i.value=!1),title:"提示信息"},{content:Ve((()=>[g(n,{title:"您确认要删除此应用吗？"})])),action:Ve((()=>[g(d,{color:"primary",onClick:v,raised:""},{default:Ve((()=>[Te])),_:1})])),_:1},8,["open"])])}}});Ie.__scopeId="data-v-058e8767";const Me={key:0,class:"builder-card"},ze={class:"head-flexbox"},Ee={class:"builder-head"},qe={class:"builder-info"},Ze=O("IP："),Fe=O(" Arch："),Le=O(" CPU核数："),Ue={class:"head-actions"},Ae={key:1,class:"builder-card"},Ne={key:0},De={key:1};var He=r({expose:[],setup(e){Z(),F();const t=q(),s=c((()=>t.state.channel.edge)),a=y(0);j((()=>s.value),((e,t)=>{e!==t&&a.value++})),P((()=>{})),d((()=>{})),n((()=>{}));const l=[{label:"图表",value:"charts"}],o=y({}),i=e=>{o.value=e};return(e,t)=>{const r=te,n=T,d=we,c=Pe,f=Ie,_=R,y=C("tooltip");return p(),u("div",null,[m(s).edge_id?(p(),u("div",Me,[g(r,{topic:m(s).edge_id,onmessage:i},null,8,["topic"]),g("div",ze,[g("div",Ee,[g("h3",null,h(m(s).esn||m(s).edge_id),1),g("div",qe,[m(s).esn?(p(),u(b,{key:0},[Ze,g("strong",null,h(m(s).ip),1)],64)):v("",!0),Fe,g("strong",null,h(m(s).arch),1),Le,g("strong",null,h(m(s).num_cpus),1)])]),g("div",Ue,[1===m(s).health?V((p(),u(n,{key:0,color:"info",onClick:t[1]||(t[1]=e=>{s.value.edge_id&&(W.value=s.value.edge_id,G.value="terminal",K.value="edges")}),icon:"fa fa-desktop"},null,512)),[[y,"打开终端",void 0,{bottom:!0,right:!0,rounded:!0}]]):v("",!0)])])])):v("",!0),m(s)?(p(),u("div",Ae,[m(s).edge_id?(p(),u(d,{key:0,stats:o.value,edge:m(s)},null,8,["stats","edge"])):v("",!0)])):v("",!0),1===m(s).health?(p(),u(_,{key:2,selected:"charts",tabs:[...l,...m(s).engines.map((e=>({label:e.engine_name,value:e.engine_name})))]},{tab:$((({activeValue:e})=>["charts"===e?(p(),u("div",Ne,[m(s).edge_id?(p(),u(c,{key:m(s).edge_id,edge:m(s),stats:o.value},null,8,["edge","stats"])):v("",!0)])):(p(),u("div",De,[g(f,{key:a.value,deploys:m(s).instances[e],edge:m(s).edge_id},null,8,["deploys","edge"])]))])),_:1},8,["tabs"])):v("",!0)])}}});const Je={class:"page-title has-text-centered"},Qe={class:"menu-toggle has-chevron"},Re=g("span",{class:"rotate"},[g("i",{class:"icon-line-top"}),g("i",{class:"icon-line-center"}),g("i",{class:"icon-line-bottom"})],-1),We=g("div",{class:"title-wrap"},[g("h1",{class:"title is-4"},"终端详情")],-1),Ge={class:"page-content-inner"},Ke={class:"breadcrumb-box"},Xe=g("i",{class:"iconify","data-icon":"feather:corner-down-left"},null,-1);var Ye=r({expose:[],setup(e){const t=Z(),s=F(),a=q(),l=y(!0);L({title:"终端详情"}),P((()=>{Y.value="none"}));const o=y();return n((()=>{a.dispatch("channel/getEdge",t.params.edgeid).then((e=>{o.value=[{icon:"feather:home",hideLabel:!0,to:{name:"admin-users"}},{label:"终端管理",to:{name:"admin-edges"}},{label:e.hostname||e.ip||e.edge_id}],l.value=!1}))})),(e,t)=>{const a=i,r=He,n=X;return p(),u("div",null,[g("div",Je,[g("div",{class:"vuero-hamburger nav-trigger push-resize",onClick:t[1]||(t[1]=e=>m(ee)("none"))},[g("span",Qe,[g("span",{class:[["none"===m(Y)&&""],"icon-box-toggle"]},[Re],2)])]),We]),g("div",Ge,[g(n,{size:"large",active:l.value},{default:$((()=>[g("div",Ke,[o.value?(p(),u(a,{key:0,items:o.value,separator:"bullet","with-icons":""},null,8,["items"])):v("",!0),g("div",{class:"back-button",onClick:t[2]||(t[2]=()=>m(s).back())},[Xe])]),g(r)])),_:1},8,["active"])])])}}});export default Ye;
