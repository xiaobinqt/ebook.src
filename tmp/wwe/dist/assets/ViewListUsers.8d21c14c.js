import{a as e,_ as a}from"./V-Field.vue_vue&type=script&setup=true&lang.50df6a27.js";import{_ as l}from"./V-Button.vue_vue&type=script&setup=true&lang.7d7c3fd2.js";import{_ as s}from"./V-FlexNone.vue_vue&type=script&setup=true&lang.cbed393c.js";import{a as t,c as o,d as r}from"./index.670b29b2.js";import{u as i}from"./useDropdown.490deeca.js";import{d as n,v as u,j as d,k as c,n as p,u as v,A as f,i as m,B as h,C as _,S as g,F as x,Q as y,U as w,P as b,r as k,b as U,a as j,W as V,X as C,Z as D,$ as S,E as z,z as N,x as Y}from"./vendor.6243191d.js";import{_ as q}from"./V-FlexTable.vue_vue&type=script&setup=true&lang.19fc13e5.js";import{_ as A}from"./V-FlexPagination.vue_vue&type=script&setup=true&lang.036e60ba.js";import{_ as F}from"./V-Checkbox.vue_vue&type=script&setup=true&lang.27382a85.js";import{_ as I}from"./V-Modal.vue_vue&type=script&setup=true&lang.13c249d1.js";import{_ as M}from"./V-PlaceholderSection.vue_vue&type=script&setup=true&lang.67c36c04.js";import{u as O}from"./useNotyf.8c9a8697.js";import{h as P}from"./moment.08a7f518.js";const B=p("i",{class:"iconify","data-icon":"feather:more-vertical"},null,-1),E={class:"dropdown-menu",role:"menu",style:{"min-width":"auto"}},T={class:"dropdown-content"},Q=p("span",null,"修改",-1),W={key:0},X={key:1};var Z=n({expose:[],props:{row:{type:Object,required:!0}},setup(e){const{row:a}=e;t(),o();const l=r(),{dropdownElement:s,isOpen:n,toggle:h}=i(),_=u((()=>l.state.channel.user)),g=m("viewUser");m("auditUser"),m("removeUser");const x=m("StopUserStatus"),y=m("StartUserStatus");return(e,l)=>(d(),c("div",{ref:s,class:[[v(n)&&"is-active"],"dropdown is-spaced is-dots is-right dropdown-trigger is-pushed-mobile"]},[p("div",{class:"is-trigger","aria-haspopup":"true",onClick:l[1]||(l[1]=(...e)=>v(h)&&v(h)(...e))},[B]),p("div",E,[p("div",T,[p("a",{href:"#",class:"dropdown-item is-media",onClick:l[2]||(l[2]=e=>{g(a)})},[Q]),1===v(_).super_admin?(d(),c("a",{key:0,href:"#",class:"dropdown-item is-media",onClick:l[3]||(l[3]=e=>{1===a.status?x(a):4===a.status&&y(a)})},[1===a.status?(d(),c("span",W,"停用")):4===a.status?(d(),c("span",X,"启用")):f("",!0)])):f("",!0)])])],2))}});h("data-v-75d649c5");const $={class:"flex-table-cell flex-grow-short","data-th":"Name"},G={class:"flex-table-cell flex-grow-short","data-th":"Name"},H={class:"flex-table-cell right flex-grow-short","data-th":"Phone"},J={class:"flex-table-cell flex-grow-2","data-th":"CreateAt"},K={class:"flex-table-cell flex-grow-short","data-th":"CreateAt"},L={class:"flex-table-cell flex-grow-status status-row","data-th":"Name"},R={key:0,class:"statusOut"},ee={key:1,class:"statusIn"},ae={key:0,class:"flex-table-cell flex-grow-status status-row","data-th":"Name"},le={key:0},se={key:1},te={class:"flex-table-cell cell-end end","data-th":"Actions"};_();var oe=n({expose:[],props:{rows:{type:Array,required:!0},user:{type:Object,required:!0}},setup(e){function a(e){return e.length>15&&(e=e.substr(0,15)+"..."),e}return(l,s)=>{const t=Z,o=y("tooltip");return d(!0),c(x,null,g(e.rows,(l=>{return d(),c("div",{key:l.id,class:"flex-table-item"},[p("div",$,w(l.real_name),1),b(p("div",{class:"flex-table-cell flex-grow-short","data-th":"Name"},w((s=l.user_name,s.length>8&&(s=s.substr(0,8)+"..."),s)),513),[[o,l.user_name,void 0,{top:!0,right:!0,rounded:!0}]]),p("div",G,w(1==l.role?"普通用户":"管理员"),1),b(p("div",{class:"flex-table-cell flex-grow-3","data-th":"Email"},w(a(l.email)),513),[[o,l.email,void 0,{top:!0,right:!0,rounded:!0}]]),p("div",H,w(l.phone),1),p("div",J,w(l.create_time),1),p("div",K,[p("span",{style:"color: "+((new Date).getTime()>new Date(l.expire_date).getTime()?"#e62864ff":"")},w("0000-00-00"===l.expire_date?"永久有效":l.expire_date),5)]),p("div",L,[0===l.online?(d(),c("div",R)):1===l.online?(d(),c("div",ee)):f("",!0)]),1===e.user.super_admin?(d(),c("div",ae,[1===l.status?(d(),c("span",le,"启用")):f("",!0),4===l.status?(d(),c("span",se,"停用")):f("",!0)])):f("",!0),p("div",te,[p(t,{key:l.user_id,row:l},null,8,["row"])])]);var s})),128)}}});oe.__scopeId="data-v-75d649c5";const re=S();h("data-v-59f793df");const ie={key:0},ne={class:"list-view-toolbar"},ue={class:"select"},de=p("option",{value:""},"全部角色",-1),ce=p("option",{value:"2"},"管理员",-1),pe=p("option",{value:"1"},"普通用户",-1),ve={class:"select"},fe=p("option",{value:"-1"},"全部状态",-1),me=p("option",{value:"0"},"离线",-1),he=p("option",{value:"1"},"在线",-1),_e={class:"buttons"},ge={class:"page-content-inner"},xe={class:"flex-table-header"},ye=p("span",{class:"flex-grow-short"},"姓名",-1),we=p("span",{class:"flex-grow-short"},"账号",-1),be=p("span",{class:"flex-grow-short"},"类型",-1),ke=p("span",{class:"flex-grow-3"},"邮箱",-1),Ue=p("span",{class:"flex-grow-short"},"电话",-1),je=p("span",{class:"flex-grow-2"},"注册时间",-1),Ve=p("span",{class:"flex-grow-short"},"过期时间",-1),Ce=p("span",{class:"flex-grow-status"},"在线状态",-1),De={key:0,class:"flex-grow-status"},Se=p("span",{class:"cell-end end"},"操作",-1),ze={class:"form-inner"},Ne={class:"field is-horizontal"},Ye=p("div",{class:"field-label is-normal"},[p("label",{class:"label"},"角色")],-1),qe={class:"field-body"},Ae={class:"select"},Fe=p("option",{value:"1"},"普通用户",-1),Ie=p("option",{value:"2"},"管理员",-1),Me={class:"field is-horizontal"},Oe=p("div",{class:"field-label is-normal"},[p("label",{class:"label"},"有效期")],-1),Pe={class:"field-body"},Be=z("确定"),Ee=z("确认"),Te=z("确认"),Qe=z("确认");_();var We=n({expose:[],props:{audit:{type:Boolean,default:!1}},setup(i){const{audit:n}=i,m=t(),h=o(),_=r(),g=O(),x=k(!1),y=k(!1),w=k(),S=k(!0),z=k(""),B=k(!1),E=k(""),T=k("-1"),Q=k(!1),W=k(!1),X=u((()=>{try{return Number.parseInt(m.query.page)||1}catch(e){}return 1})),Z=u((()=>_.state.channel.users)),$=u((()=>_.state.channel.user)),G=U({role:1,expire_date:"",expire:[]});N("viewUser",(e=>{y.value=!1,x.value=!0,w.value=e,"永久"===w.value.ex_expire_time_str?G.expire[0]="0000-00-00":G.expire=[],G.role=w.value.role,G.expire_date=w.value.expire_date}));N("auditUser",(e=>{y.value=!0,x.value=!0,w.value=e}));const H=()=>{_.dispatch("channel/userStatus",w.value).then((e=>{Q.value=!1,W.value=!1,_.dispatch("channel/getUsers",{page:X.value,size:10,search:z.value,role:E?E.value:void 0,online:T?T.value:void 0}).then((()=>{S.value=!1,Y((()=>{S.value=!0}))}))}))};N("StopUserStatus",(e=>{Q.value=!0,w.value=e})),N("StartUserStatus",(e=>{W.value=!0,w.value=e}));const J=e=>{_.dispatch("channel/delUser",w.value.user_id).then((()=>{g.success("删除成功！"),B.value=!1,_.dispatch("channel/getUsers",{page:X.value,size:10})}))};N("removeUser",(e=>{B.value=!0,w.value=e})),j([z,E,T,X],((e,a)=>{e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]||(h.push("users"),_.dispatch("channel/getUsers",{page:1,size:10,search:e[0],status:n?"0":void 0,role:E?E.value:void 0,online:T?T.value:void 0})),e[3]!==a[3]&&_.dispatch("channel/getUsers",{page:X.value,size:10,search:e[0],status:n?"0":void 0,role:E?E.value:void 0,online:T?T.value:void 0})}));const K=k(P(new Date).format("YYYY-MM-DD")),L=k(P((new Date).setDate((new Date).getDate()+90)).format("YYYY-MM-DD")),R=()=>{console.log("user",w),console.log("user.value.user_id",w.value.user_id),console.log("formData",G),G.expire||!(G.expire_date<K.value||G.expire_date>L.value)?_.dispatch("channel/updateUser",{user_id:w.value.user_id,role:parseInt(G.role),expire_date:G.expire[0]?"0000-00-00":G.expire_date}).then((()=>{x.value=!1,g.success("修改成功！"),_.dispatch("channel/getUsers",{page:X.value,size:10,status:n?"0":void 0,role:E?E.value:void 0,online:T?T.value:void 0}).then((()=>{S.value=!1,Y((()=>{S.value=!0}))}))})):g.error("有效期范围无效")};return V((()=>{_.dispatch("channel/getUsers",{page:X.value,size:10,status:n?"0":void 0,online:"-1"})})),(t,o)=>{const r=e,i=a,n=l,u=s,m=oe,h=q,_=A,g=F,y=I,k=M,U=l,j=I;return v(Z).page_info?(d(),c("div",ie,[p("div",ne,[p(i,null,{default:re((()=>[p(r,{icon:"feather:search"},{default:re((()=>[b(p("input",{"onUpdate:modelValue":o[1]||(o[1]=e=>z.value=e),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[C,z.value]])])),_:1})])),_:1}),p(i,null,{default:re((()=>[p(r,null,{default:re((()=>[p("div",ue,[b(p("select",{"onUpdate:modelValue":o[2]||(o[2]=e=>E.value=e)},[de,ce,pe],512),[[D,E.value]])])])),_:1})])),_:1}),p(i,null,{default:re((()=>[p(r,null,{default:re((()=>[p("div",ve,[b(p("select",{"onUpdate:modelValue":o[3]||(o[3]=e=>T.value=e)},[fe,me,he],512),[[D,T.value]])])])),_:1})])),_:1}),f("",!0),p("div",_e,[f("",!0)])]),p("div",ge,[v(Z)&&0===v(Z).data.length?(d(),c(u,{key:0,title:"没有数据",subtitle:"当前没有要显示的数据"})):(d(),c(h,{key:1,compact:""},{header:re((()=>[p("div",xe,[ye,we,be,ke,Ue,je,Ve,Ce,1===v($).super_admin?(d(),c("span",De,"是否启用")):f("",!0),Se])])),body:re((()=>[S.value?(d(),c(m,{key:0,rows:v(Z).data,user:v($)},null,8,["rows","user"])):f("",!0)])),_:1})),v(Z).page_info.count?(d(),c(_,{key:2,"item-per-page":v(Z).page_info.size,"total-items":v(Z).page_info.count,"current-page":v(X),"max-links-displayed":5},null,8,["item-per-page","total-items","current-page"])):f("",!0)]),w.value?(d(),c(y,{key:0,open:x.value,size:"large",actions:"center",title:"用户账号："+w.value.user_name,onClose:o[7]||(o[7]=e=>x.value=!1)},{content:re((()=>[p("div",ze,[p("div",Ne,[Ye,p("div",qe,[p(i,null,{default:re((()=>[p(r,null,{default:re((()=>[p("div",Ae,[b(p("select",{"onUpdate:modelValue":o[4]||(o[4]=e=>v(G).role=e)},[Fe,Ie],512),[[D,v(G).role]])])])),_:1})])),_:1})])]),p("div",Me,[Oe,p("div",Pe,[p(i,null,{default:re((()=>[p(r,null,{default:re((()=>[b(p("input",{class:"input",type:"date",style:{display:v(G).expire.length>0?"none":"inline-block"},required:"",min:K.value,max:L.value,"onUpdate:modelValue":o[5]||(o[5]=e=>v(G).expire_date=e),placeholder:"2021-09-11"},null,12,["min","max"]),[[C,v(G).expire_date]]),p("input",{class:"input",style:{display:0===v(G).expire.length?"none":"inline-block"},type:"date",readonly:"",placeholder:"2021-09-11"},null,4)])),_:1})])),_:1}),p(i,null,{default:re((()=>[p(r,null,{default:re((()=>[p(g,{modelValue:v(G).expire,"onUpdate:modelValue":o[6]||(o[6]=e=>v(G).expire=e),value:"0000-00-00",label:"永久有效",solid:""},null,8,["modelValue"])])),_:1})])),_:1})])])])])),action:re((()=>[p(n,{color:"primary",onClick:R,raised:""},{default:re((()=>[Be])),_:1})])),_:1},8,["open","title"])):f("",!0),p(j,{open:B.value,actions:"center",onClose:o[8]||(o[8]=e=>B.value=!1),title:"提示信息"},{content:re((()=>[p(k,{title:"您确认要删除此用户吗？"})])),action:re((()=>[p(U,{color:"primary",onClick:J,raised:""},{default:re((()=>[Ee])),_:1})])),_:1},8,["open"]),p(j,{open:Q.value,actions:"center",onClose:o[9]||(o[9]=e=>Q.value=!1),title:"提示信息"},{content:re((()=>[p(k,{title:"您确认要停用此用户吗？"})])),action:re((()=>[p(U,{color:"primary",onClick:H,raised:""},{default:re((()=>[Te])),_:1})])),_:1},8,["open"]),p(j,{open:W.value,actions:"center",onClose:o[10]||(o[10]=e=>W.value=!1),title:"提示信息"},{content:re((()=>[p(k,{title:"您确认要启用此用户吗？"})])),action:re((()=>[p(U,{color:"primary",onClick:H,raised:""},{default:re((()=>[Qe])),_:1})])),_:1},8,["open"])])):f("",!0)}}});We.__scopeId="data-v-59f793df";export{We as _};
