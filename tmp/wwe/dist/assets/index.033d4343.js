var e=Object.defineProperty,a=Object.prototype.hasOwnProperty,s=Object.getOwnPropertySymbols,t=Object.prototype.propertyIsEnumerable,l=(a,s,t)=>s in a?e(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;import{_ as r}from"./V-Breadcrumb.vue_vue&type=script&setup=true&lang.95222eda.js";import{_ as o}from"./V-Button.vue_vue&type=script&setup=true&lang.7d7c3fd2.js";import{_ as i}from"./V-FlexNone.vue_vue&type=script&setup=true&lang.cbed393c.js";import{_ as c}from"./V-Tag.vue_vue&type=script&setup=true&lang.bf8fa42e.js";import{a as n,c as d,d as u,u as p}from"./index.670b29b2.js";import{u as v}from"./useDropdown.490deeca.js";import{d as m,j as f,k as b,n as g,u as h,A as _,i as j,B as y,C as w,S as x,F as k,l as B,Q as P,E as z,U as C,P as V,$ as O,r as U,v as I,a as S,W as q,f as F,z as A,O as N,b as E,m as L,X as D,Z as M}from"./vendor.6243191d.js";import{t as R,m as T}from"./filters.e49d41fb.js";import{_ as Q}from"./V-FlexTable.vue_vue&type=script&setup=true&lang.19fc13e5.js";import{_ as W}from"./V-FlexPagination.vue_vue&type=script&setup=true&lang.036e60ba.js";import{_ as X}from"./V-Modal.vue_vue&type=script&setup=true&lang.13c249d1.js";import{u as Z}from"./useNotyf.8c9a8697.js";import{_ as $}from"./V-Loader.vue_vue&type=script&setup=true&lang.152a1df5.js";import{a as G,_ as H}from"./V-Field.vue_vue&type=script&setup=true&lang.50df6a27.js";import{a as J,t as K}from"./activeSidebarState.4b53b430.js";import"./V-PlaceholderSection.vue_vue&type=script&setup=true&lang.67c36c04.js";import"./moment.08a7f518.js";const Y=g("i",{class:"iconify","data-icon":"feather:more-vertical"},null,-1),ee={class:"dropdown-menu",role:"menu",style:{"min-width":"auto"}},ae={class:"dropdown-content"},se=g("div",{class:"icon"},[g("i",{class:"fas fa-trash"})],-1),te=g("div",{class:"meta"},[g("span",null,"删除")],-1);var le=m({expose:[],props:{row:{type:Object,required:!0}},setup(e){const{row:a}=e;n(),d(),u();const{dropdownElement:s,isOpen:t,toggle:l}=v();j("startBuild");const r=j("removeBuilder");return(e,o)=>(f(),b("div",{ref:s,class:[[h(t)&&"is-active"],"dropdown is-spaced is-dots is-right dropdown-trigger is-pushed-mobile"]},[g("div",{class:"is-trigger","aria-haspopup":"true",onClick:o[1]||(o[1]=(...e)=>h(l)&&h(l)(...e))},[Y]),g("div",ee,[g("div",ae,[_("",!0),_("",!0),g("a",{href:"#",class:"dropdown-item is-media",onClick:o[4]||(o[4]=e=>h(r)(a))},[se,te])])])],2))}});const re=O();y("data-v-157bb569");const oe={class:"flex-table-cell flex-grow-short","data-th":"Name"},ie={class:"route-link"},ce={class:"flex-table-cell flex-grow-short","data-th":"Status"},ne={class:"flex-table-cell flex-grow-short","data-th":"branch"},de={class:"light-text"},ue=g("br",null,null,-1),pe={class:"flex-table-cell flex-grow-time","data-th":"Phone"},ve={class:"flex-table-cell flex-grow-short","data-th":"Phone"},me={class:"light-text"},fe={class:"flex-table-cell flex-grow-time","data-th":"Phone"},be={class:"light-text"},ge={class:"flex-table-cell flex-grow-millis","data-th":"Phone"},he={class:"light-text"},_e={class:"flex-table-cell cell-end end","data-th":"Phone"};w();var je=m({expose:[],props:{rows:{type:Array,required:!0}},setup:e=>(a,s)=>{const t=B("RouterLink"),l=c,r=le,o=P("tooltip");return f(!0),b(k,null,x(e.rows,(e=>{return f(),b("div",{key:e.id,class:"flex-table-item"},[g("div",oe,[g("span",ie,[g(t,{to:{name:"user-projects-projectid-job-number",params:{projectid:e.project_id,number:e.number}}},{default:re((()=>[z(C(("00000"+e.number).slice(-4)),1)])),_:2},1032,["to"])])]),g("div",ce,["success"===e.status?(f(),b(l,{key:0,color:"success",label:"成功",rounded:""})):_("",!0),"failed"===e.status?(f(),b(l,{key:1,color:"danger",label:"失败",rounded:""})):_("",!0),"created"===e.status?(f(),b(l,{key:2,label:"已创建",rounded:""})):_("",!0),"doing"===e.status?(f(),b(l,{key:3,color:"warning",label:"构建中",rounded:""})):_("",!0),"cancel"===e.status?(f(),b(l,{key:4,label:"已取消",rounded:""})):_("",!0),"waiting"===e.status?(f(),b(l,{key:5,color:"orange",label:"等候",rounded:""})):_("",!0)]),g("div",ne,[g("span",de,[z(C(e.branch)+" ",1),ue])]),g("div",pe,[V(g("span",{class:"light-text"},C((a=e.desc,a.length>10&&(a=a.substr(0,10)+"..."),a)),513),[[o,e.desc,void 0,{top:!0,right:!0,wrap:!0,rounded:!0}]])]),g("div",ve,[g("span",me,C(e.cpu),1)]),g("div",fe,[g("span",be,C(h(R)(e.start_time)),1)]),g("div",ge,[g("span",he,C(h(T)(e.run_time_millis)),1)]),g("div",_e,[g(r,{row:e},null,8,["row"])])]);var a})),128)}});je.__scopeId="data-v-157bb569";const ye=O();y("data-v-a16afb6c");const we={key:0},xe={class:"page-content-inner"},ke=g("div",{class:"flex-table-header"},[g("span",{class:"flex-grow-short"},"编号"),g("span",{class:"flex-grow-short"},"构建状态"),g("span",{class:"flex-grow-short"},"代码分支"),g("span",{class:"flex-grow-time"},"构建描述"),g("span",{class:"flex-grow-short"},"CPU型号"),g("span",{class:"flex-grow-time"},"开始时间"),g("span",{class:"flex-grow-millis"},"时长"),g("span",{class:"cell-end end"},"操作")],-1),Be=z("适配"),Pe=g("h2",{style:{"text-align":"center","font-weight":"700"}},"您确定要删除此构建项目吗?",-1),ze=z("确认");w();var Ce=m({expose:[],setup(e){const a=n(),s=d(),t=u(),l=U(!1);U();const r=U(""),c=U(),p=Z(),v=U(!1),m=I((()=>{try{return Number.parseInt(a.query.page)||1}catch(e){}return 1})),j=I((()=>t.state.user.builders));A("removeBuilder",(e=>{c.value=e,v.value=!0}));const y=()=>{t.dispatch("channel/delBuilder",c.value).then((e=>{p.success("删除成功！"),v.value=!1,s.push("builds"),t.dispatch("user/getBuilders",{id:c.value.project_id,page:1,size:10,search:r.value})}),(e=>{p.error("删除失败"),v.value=!1}))};A("startBuild",(e=>{l.value=!0})),S([r,m],((e,s)=>{e[0]!==s[0]&&(a.path("builds"),t.dispatch("user/getBuilders",{id:a.params.projectid,page:1,size:10,search:e[0]})),e[1]!==s[1]&&t.dispatch("user/getBuilders",{id:a.params.projectid,page:m.value,size:10,search:e[0]})}));let w=0;return q((()=>{w=window.setInterval((()=>{t.dispatch("user/getBuilders",{id:a.params.projectid,page:1,size:10}).then((e=>{"success"!==e[0].status&&"failed"!==e[0].status||window.clearInterval(w)}))}),3e3)})),F((()=>{window.clearInterval(w)})),(e,a)=>{const s=i,t=je,r=Q,c=W,n=o,d=X,u=o,p=X;return h(j).page_info?(f(),b("div",we,[g("div",xe,[h(j)&&0===h(j).data.length?(f(),b(s,{key:0,title:"没有数据",subtitle:"当前没有要显示的数据"})):(f(),b(r,{key:1,compact:""},{header:ye((()=>[ke])),body:ye((()=>[g(t,{rows:h(j).data},null,8,["rows"])])),_:1})),h(j).page_info.count?(f(),b(c,{key:2,"item-per-page":h(j).page_info.size,"total-items":h(j).page_info.count,"current-page":h(m),"max-links-displayed":5},null,8,["item-per-page","total-items","current-page"])):_("",!0),g(d,{open:l.value,size:"large",actions:"center",title:"开始适配",onClose:a[1]||(a[1]=e=>l.value=!1)},{content:ye((()=>[])),action:ye((()=>[g(n,{color:"primary",raised:""},{default:ye((()=>[Be])),_:1})])),_:1},8,["open"])]),g(p,{open:v.value,actions:"center",onClose:a[2]||(a[2]=e=>v.value=!1),title:"提示信息"},{content:ye((()=>[Pe])),action:ye((()=>[g(u,{color:"primary",onClick:y,raised:""},{default:ye((()=>[ze])),_:1})])),_:1},8,["open"])])):_("",!0)}}});Ce.__scopeId="data-v-a16afb6c";const Ve={class:"page-title has-text-centered"},Oe={class:"menu-toggle has-chevron"},Ue=g("span",{class:"rotate"},[g("i",{class:"icon-line-top"}),g("i",{class:"icon-line-center"}),g("i",{class:"icon-line-bottom"})],-1),Ie=g("div",{class:"title-wrap"},[g("h1",{class:"title is-4"},"持续集成")],-1),Se={class:"page-content-inner"},qe={class:"breadcrumb-box"},Fe=g("i",{class:"iconify","data-icon":"feather:corner-down-left"},null,-1),Ae={class:"list-view-toolbar"},Ne={class:"buttons"},Ee=z(" 立即构建 "),Le={key:0},De={class:"field is-horizontal"},Me=g("div",{class:"field-label is-normal"},[g("label",{class:"label required"},"制品包名称")],-1),Re={class:"field-body"},Te={class:"field is-horizontal"},Qe=g("div",{class:"field-label is-normal"},[g("label",{class:"label required"},"代码分支")],-1),We={class:"field-body"},Xe={class:"select"},Ze=g("option",{value:""},"请选择代码分支",-1),$e={class:"field is-horizontal"},Ge=g("div",{class:"field-label is-normal"},[g("label",{class:"label required"},"CPU 型号")],-1),He={class:"field-body"},Je={class:"select"},Ke=g("option",{value:""},"请选择CPU型号",-1),Ye=g("option",{value:"armv7"},"ARM Cortex-A7",-1),ea={class:"field is-horizontal"},aa=g("div",{class:"field-label is-normal"},[g("label",{class:"label"},"构建描述")],-1),sa={class:"field-body"},ta=z(" 确定 ");var la=m({expose:[],setup(e){const i=n(),c=d(),v=u(),m=Z(),j=U(!0);p({title:"持续集成"}),N((()=>{J.value="projects"}));const y=U(!1),w=()=>{y.value=!0},B=I((()=>v.state.user.project)),P=U([]),z=U(),O=E({artifact_name:"",branch:"master",cpu:"",desc:""}),S=()=>{""!==O.branch?""!==O.cpu?v.dispatch("user/startBuilder",((e,r)=>{for(var o in r||(r={}))a.call(r,o)&&l(e,o,r[o]);if(s)for(var o of s(r))t.call(r,o)&&l(e,o,r[o]);return e})({id:i.params.projectid},O)).then((()=>{y.value=!1,v.dispatch("user/getBuilders",{id:i.params.projectid,page:1,size:10}).then((e=>{console.log("data",e),"doing"!==e[0].status&&"waiting"!==e[0].status||c.push({name:"user-projects-projectid-job-number",params:{projectid:i.params.projectid,number:e[0].number}})}))})):m.error("请选择CPU型号"):m.error("请选择代码分支")};return q((()=>{Promise.all([v.dispatch("user/getProject",i.params.projectid),v.dispatch("user/getBuilders",{id:i.params.projectid,page:1,size:10})]).then((()=>{z.value=[{icon:"feather:home",hideLabel:!0,to:{name:"user-projects"}},{label:"项目列表",to:{name:"user-projects"}},{label:B.value.repo_name,to:{name:"user-projects-projectid-files",params:{projectid:i.params.projectid}}},{label:"持续集成"}],O.artifact_name=B.value.repo_name,console.log("formData",O,B.value.repo_name),j.value=!1})),v.dispatch("user/getBranches",{id:i.params.projectid,simple:!1}).then((()=>{P.value=v.getters["user/getSimpleBranches"]}))})),(e,a)=>{const s=r,t=o,l=Ce,i=$,n=G,d=H,u=X;return f(),b("div",null,[g("div",Ve,[g("div",{class:"vuero-hamburger nav-trigger push-resize",onClick:a[1]||(a[1]=e=>h(K)("projects"))},[g("span",Oe,[g("span",{class:[["projects"===h(J)&&"active"],"icon-box-toggle"]},[Ue],2)])]),Ie]),g("div",Se,[g(i,{size:"large",active:j.value},{default:L((()=>[g("div",qe,[z.value?(f(),b(s,{key:0,items:z.value,separator:"bullet","with-icons":""},null,8,["items"])):_("",!0),g("div",{onClick:a[2]||(a[2]=()=>h(c).back())},[Fe])]),g("div",Ae,[g("div",Ne,[g(t,{color:"primary",onClick:w},{default:L((()=>[Ee])),_:1})])]),g(l)])),_:1},8,["active"])]),g(u,{open:y.value,size:"large",actions:"center",title:"开始构建",onClose:a[7]||(a[7]=e=>y.value=!1)},{content:L((()=>[P.value?(f(),b("div",Le,[g("div",De,[Me,g("div",Re,[g(d,null,{default:L((()=>[g(n,null,{default:L((()=>[V(g("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>h(O).artifact_name=e),disabled:"",readonly:"",class:"input",type:"text",placeholder:"制品包名称"},null,512),[[D,h(O).artifact_name]])])),_:1})])),_:1})])]),g("div",Te,[Qe,g("div",We,[g(d,null,{default:L((()=>[g(n,null,{default:L((()=>[g("div",Xe,[V(g("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>h(O).branch=e)},[Ze,(f(!0),b(k,null,x(P.value,(e=>(f(),b("option",{value:e.value},C(e.value),9,["value"])))),256))],512),[[M,h(O).branch]])])])),_:1})])),_:1})])]),g("div",$e,[Ge,g("div",He,[g(d,null,{default:L((()=>[g(n,null,{default:L((()=>[g("div",Je,[V(g("select",{"onUpdate:modelValue":a[5]||(a[5]=e=>h(O).cpu=e)},[Ke,Ye],512),[[M,h(O).cpu]])])])),_:1})])),_:1})])]),g("div",ea,[aa,g("div",sa,[g(d,null,{default:L((()=>[g(n,null,{default:L((()=>[V(g("textarea",{class:"textarea",rows:"6",placeholder:"请输入构建描述","onUpdate:modelValue":a[6]||(a[6]=e=>h(O).desc=e)},"\n              ",512),[[D,h(O).desc]])])),_:1})])),_:1})])])])):_("",!0)])),action:L((()=>[g(t,{color:"primary",onClick:S},{default:L((()=>[ta])),_:1})])),_:1},8,["open"])])}}});export default la;
