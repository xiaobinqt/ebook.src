var e=Object.defineProperty,a=Object.prototype.hasOwnProperty,t=Object.getOwnPropertySymbols,s=Object.prototype.propertyIsEnumerable,r=(a,t,s)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;import{_ as l}from"./V-Breadcrumb.vue_vue&type=script&setup=true&lang.95222eda.js";import{_ as o}from"./V-Button.vue_vue&type=script&setup=true&lang.7d7c3fd2.js";import{a as c,_ as n}from"./V-Field.vue_vue&type=script&setup=true&lang.50df6a27.js";import{_ as i}from"./V-Tag.vue_vue&type=script&setup=true&lang.bf8fa42e.js";import{_ as u}from"./V-IconButton.vue_vue&type=script&setup=true&lang.88eaeff3.js";import{_ as p}from"./V-Buttons.vue_vue&type=script&setup=true&lang.88c78073.js";import{t as d}from"./filters.e49d41fb.js";import{d as m,j as v,k as f,S as b,F as h,i as j,l as g,n as _,m as y,U as x,u as k,B as w,C as V,r as C,v as q,b as O,W as P,E as T,A as z,P as B,Z as N,X as S,$ as I,z as A,O as F}from"./vendor.6243191d.js";import{_ as L}from"./V-FlexTable.vue_vue&type=script&setup=true&lang.19fc13e5.js";import{_ as U}from"./V-Modal.vue_vue&type=script&setup=true&lang.13c249d1.js";import{a as E,c as M,d as R,u as W}from"./index.670b29b2.js";import{u as X}from"./useNotyf.8c9a8697.js";import{_ as Z}from"./V-Loader.vue_vue&type=script&setup=true&lang.152a1df5.js";import{a as $,t as D}from"./activeSidebarState.4b53b430.js";import"./moment.08a7f518.js";const G={class:"flex-table-cell","data-th":"Name"},H={class:"flex-table-cell","data-th":"Name"},J={class:"flex-table-cell","data-th":"Name"},K={class:"flex-table-cell cell-end","data-th":"Actions"};var Q=m({expose:[],props:{rows:{type:Array,required:!0},project:{type:String,required:!0}},setup(e){const a=j("removeTag");return(t,s)=>{const r=i,l=g("RouterLink"),o=u,c=p;return v(!0),f(h,null,b(e.rows,(t=>(v(),f("div",{key:t.id,class:"flex-table-item"},[_("div",G,[_(l,{to:{name:"user-projects-projectid-files",params:{projectid:e.project},query:{branch:t.name,dir_path:""}}},{default:y((()=>[_(r,{color:"info",label:t.name},null,8,["label"])])),_:2},1032,["to"])]),_("div",H,x(t.message),1),_("div",J,x(k(d)(t.commit.created)),1),_("div",K,[_(c,null,{default:y((()=>[_(o,{onClick:e=>k(a)(t.name),icon:"feather:trash-2",color:"danger",circle:""},null,8,["onClick"])])),_:2},1024)])])))),128)}}});const Y=I();w("data-v-8ebc5076");const ee={class:"page-content-inner"},ae={class:"list-view-toolbar"},te={class:"buttons"},se=T(" 新建标签 "),re=_("div",{class:"flex-table-header"},[_("span",null,"name"),_("span",null,"message"),_("span",null,"时间"),_("span",{class:"cell-end"},"操作")],-1),le={class:"form-inner"},oe={class:"field is-horizontal"},ce=_("div",{class:"field-label is-normal"},[_("label",{class:"label required"},"基础分支")],-1),ne={class:"field-body"},ie={key:0,class:"select"},ue=_("option",{value:""},"请选择基础分支",-1),pe={class:"field is-horizontal"},de=_("div",{class:"field-label is-normal"},[_("label",{class:"label required"},"标签名称")],-1),me={class:"field-body"},ve=T("确定");V();var fe=m({expose:[],setup(e){const l=X(),i=E();M();const u=R(),p=C(!1);C(""),C(!1),q((()=>{try{i.query.branch}catch(e){}return""})),q((()=>{try{return Number.parseInt(i.query.dir_path)||1}catch(e){}return 1}));const d=q((()=>u.state.user.branches)),m=q((()=>u.state.user.tags)),j=C([]),g=q((()=>u.state.user.project));q((()=>u.state.channel.user));const y=O({branch:"master",tag_name:""}),w=()=>{u.dispatch("user/getTags",{id:i.params.projectid,simple:!1}).then((()=>{}))};A("removeTag",(e=>{u.dispatch("user/removeTag",{id:i.params.projectid,name:e}).then((()=>{w(),l.success("删除成功！")}))}));const V=C(!1),I=()=>{V.value||(V.value=!0,u.dispatch("user/createTag",((e,l)=>{for(var o in l||(l={}))a.call(l,o)&&r(e,o,l[o]);if(t)for(var o of t(l))s.call(l,o)&&r(e,o,l[o]);return e})({id:i.params.projectid},y)).then((()=>{p.value=!1,V.value=!1,w()})).catch((()=>{l.error("创建标签失败"),V.value=!1})))};return P((()=>{u.dispatch("channel/getProfile"),u.dispatch("user/getBranches",{id:i.params.projectid,simple:!1}).then((e=>{j.value=e.map((e=>"string"==typeof e?e:e.name))})),w()})),(e,a)=>{const t=o,s=c,r=n,l=o,i=Q,u=L,w=c,C=n,q=U;return v(),f("div",null,[_("div",ee,[_("div",ae,[k(d)&&k(m)?(v(),f(r,{key:0,addons:""},{default:Y((()=>[_(s,null,{default:Y((()=>[_(t,{light:"",to:{name:"user-projects-projectid-branch",params:{projectid:k(g).project_id}},icon:"feather:git-branch"},{default:Y((()=>[T(" 分支 "+x(k(d).length),1)])),_:1},8,["to"])])),_:1}),_(s,null,{default:Y((()=>[_(t,{to:{name:"user-projects-projectid-tag",params:{projectid:k(g).project_id}},icon:"feather:tag"},{default:Y((()=>[T(" 标签 "+x(k(m).length),1)])),_:1},8,["to"])])),_:1})])),_:1})):z("",!0),_("div",te,[_(l,{onClick:a[1]||(a[1]=e=>{p.value=!0}),color:"primary",elevated:""},{default:Y((()=>[se])),_:1})])]),k(g).project_id?(v(),f(u,{key:0,compact:""},{header:Y((()=>[re])),body:Y((()=>[_(i,{rows:k(m),project:k(g).project_id},null,8,["rows","project"])])),_:1})):z("",!0),_(q,{open:p.value,size:"large",actions:"center",title:"开始适配",onClose:a[5]||(a[5]=e=>p.value=!1)},{content:Y((()=>[_("div",le,[_("div",oe,[ce,_("div",ne,[_(C,null,{default:Y((()=>[_(w,null,{default:Y((()=>[j.value?(v(),f("div",ie,[B(_("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>k(y).branch=e)},[ue,(v(!0),f(h,null,b(j.value,((e,a)=>(v(),f("option",{key:"i",value:e},x(e),9,["value"])))),128))],512),[[N,k(y).branch]])])):z("",!0)])),_:1})])),_:1})])]),_("div",pe,[de,_("div",me,[_(C,null,{default:Y((()=>[_(w,null,{default:Y((()=>[B(_("input",{class:"input",type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>k(y).tag_name=e),placeholder:"请输入标签名称"},null,512),[[S,k(y).tag_name]])])),_:1})])),_:1})])])])])),action:Y((()=>[_(l,{color:"primary",loading:V.value,onClick:a[4]||(a[4]=e=>I()),raised:""},{default:Y((()=>[ve])),_:1},8,["loading"])])),_:1},8,["open"])])])}}});fe.__scopeId="data-v-8ebc5076";const be={class:"page-title has-text-centered"},he={class:"menu-toggle has-chevron"},je=_("span",{class:"rotate"},[_("i",{class:"icon-line-top"}),_("i",{class:"icon-line-center"}),_("i",{class:"icon-line-bottom"})],-1),ge=_("div",{class:"title-wrap"},[_("h1",{class:"title is-4"},"标签管理")],-1),_e={class:"page-content-inner"},ye={class:"breadcrumb-box"},xe=_("i",{class:"iconify","data-icon":"feather:corner-down-left"},null,-1);var ke=m({expose:[],setup(e){const a=E(),t=M(),s=R(),r=C(!0);W({title:"标签管理"}),F((()=>{$.value="projects"})),C(!1);const o=q((()=>s.state.user.project));q((()=>s.state.channel.user));const c=C();return P((()=>{Promise.all([s.dispatch("user/getProject",a.params.projectid)]).then((()=>{c.value=[{icon:"feather:home",hideLabel:!0,to:{name:"user-projects"}},{label:"项目列表",to:{name:"user-projects"}},{label:o.value.repo_name,to:{name:"user-projects-projectid-files",params:{projectid:o.value.project_id}}},{label:"标签管理"}],r.value=!1}))})),(e,a)=>{const s=l,o=fe,n=Z;return v(),f("div",null,[_("div",be,[_("div",{class:"vuero-hamburger nav-trigger push-resize",onClick:a[1]||(a[1]=e=>k(D)("projects"))},[_("span",he,[_("span",{class:[["projects"===k($)&&"active"],"icon-box-toggle"]},[je],2)])]),ge]),_("div",_e,[_(n,{size:"large",active:r.value},{default:y((()=>[_("div",ye,[c.value?(v(),f(s,{key:0,items:c.value,separator:"bullet","with-icons":""},null,8,["items"])):z("",!0),_("div",{onClick:a[2]||(a[2]=()=>k(t).back())},[xe])]),_(o)])),_:1},8,["active"])])])}}});export default ke;
